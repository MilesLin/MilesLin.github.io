<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Miles&#39;s Journey</title>
  <subtitle>Dot Net Tourist</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://mileslin.github.io/"/>
  <updated>2017-02-13T04:30:02.183Z</updated>
  <id>https://mileslin.github.io/</id>
  
  <author>
    <name>Miles</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Welecome to Miles&#39;s Journey</title>
    <link href="https://mileslin.github.io/2100/12/Welecome-to-Miles-s-Journey/"/>
    <id>https://mileslin.github.io/2100/12/Welecome-to-Miles-s-Journey/</id>
    <published>2100-12-31T15:59:59.000Z</published>
    <updated>2017-02-13T04:30:02.183Z</updated>
    
    <content type="html"><![CDATA[<p>Welcome to my blog.</p>
<a id="more"></a>
<p>I’m Miles, from Taiwan and I’m a web developer.</p>
<p>There are many new techniques coming out each year. I really need a blog to record what I learn.</p>
<p>This blog is exactly that. To share my web development experiences, problems with work, new techniques, Angular2, .NET MVC.. etc,. I will share all of these here.</p>
<p>I’m enthusiastic about learning languages, like Japanese and English, and jogging. I’ve participated in several half marathons. I’ll sometimes discuss these topics in my blog as well, but my main focus will be web developing.</p>
<p>Anyway, if my posts can help you solve some problems, that’s my goal.</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Welcome to my blog.&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>ASP.NET 表單驗證</title>
    <link href="https://mileslin.github.io/2017/07/ASP-NET-%E8%A1%A8%E5%96%AE%E9%A9%97%E8%AD%89/"/>
    <id>https://mileslin.github.io/2017/07/ASP-NET-表單驗證/</id>
    <published>2017-07-23T06:49:29.000Z</published>
    <updated>2017-07-23T08:39:06.659Z</updated>
    
    <content type="html"><![CDATA[<p>ASP.NET 提供了很方便帳號登入登出的驗證功能，今天就來說明一下，如何使用 ASP.NET 表單驗證(FormsAuthentication)，來完成登入、登出以及驗證功能。</p>
<a id="more"></a>
<h2 id="修改-web-config-啟用表單驗證"><a href="#修改-web-config-啟用表單驗證" class="headerlink" title="修改 web.config 啟用表單驗證"></a>修改 web.config 啟用表單驗證</h2><p>首先我們要在 web.config 的 system.web 區段底下新增設定 。 <a href="https://msdn.microsoft.com/en-us/library/aa480476.aspx#pagexplained0002_aspnetforms" title="web.config 官方設定說明" target="_blank" rel="external">web.config 官方設定說明</a></p>
<ul>
<li>authentication : 程式啟用 FormsAuthentication，設定登入頁面網址(loginUrl)、timeout 時間(預設30分鐘) 等等….</li>
<li>authorization : <ul>
<li>在使用表單驗證的情況下 IIS <span class="highlight-text primary">預設所有人都可以存取任何網頁
 </span> ，所以要加入此設定，讓沒登入的使用者自動導向 loginUrl 所設定的網址。</li>
<li>如果沒有設定，則要自行寫 <a href="https://app.pluralsight.com/player?course=mvc-applications-10-extension-points-improving&author=alex-wolf&name=mvc-applications-10-extension-points-improving-m10&clip=2&mode=live&start=89.741627&noteid=0c402383-86b5-4606-abc6-a9eea92dc6b5" title="Authorize Filter" target="_blank" rel="external">Authorize Filter</a> 驗證使用者使用有權限存取網頁。<em>(微軟預設提供的 <code>Authorize</code> 無法使用)</em></li>
</ul>
</li>
</ul>
<figure class="codeblock codeblock--tabbed"><figcaption><span>web config</span><ul class="tabs"><li class="tab active">xml</li></ul></figcaption><div class="tabs-content"><figure class="highlight xml" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="tag">&lt;<span class="name">system.web</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">authentication</span> <span class="attr">mode</span>=<span class="string">"Forms"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">forms</span> <span class="attr">loginUrl</span>=<span class="string">"Login/Index"</span>             </span><br><span class="line">           <span class="attr">timeout</span>=<span class="string">"30"</span></span><br><span class="line">           <span class="attr">protection</span>=<span class="string">"All"</span></span><br><span class="line">           <span class="attr">cookieless</span>=<span class="string">"UseDeviceProfile"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">authentication</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">authorization</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">deny</span> <span class="attr">users</span>=<span class="string">"?"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">authorization</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">system.web</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div></figure>
<h2 id="實作登入程式碼"><a href="#實作登入程式碼" class="headerlink" title="實作登入程式碼"></a>實作登入程式碼</h2><p>如果對使用者的登入資訊只要使用者姓名，又或者是什麼都保持預設值就好，那其實只要一行程式碼就可以完成登入</p>
<figure class="codeblock codeblock--tabbed"><figcaption><span>Login</span><ul class="tabs"><li class="tab active">cs</li></ul></figcaption><div class="tabs-content"><figure class="highlight cs" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[HttpPost]</span><br><span class="line"><span class="function"><span class="keyword">public</span> ActionResult <span class="title">Login</span>(<span class="params"><span class="keyword">string</span> userName</span>)</span><br><span class="line"></span>{</span><br><span class="line">    <span class="comment">// 登入</span></span><br><span class="line">    FormsAuthentication.RedirectFromLoginPage(userName, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> RedirectToAction(<span class="string">"Index"</span>, <span class="string">"Home"</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div></figure>
<p>如果你想要設定 timeout 時間、存取一些額外資訊等等…，那就要採用 <code>FormsAuthenticationTicket</code> 加密後放入 Cookie。</p>
<figure class="codeblock codeblock--tabbed"><figcaption><span>Login</span><ul class="tabs"><li class="tab active">cs</li></ul></figcaption><div class="tabs-content"><figure class="highlight cs" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[HttpPost]</span><br><span class="line"><span class="function"><span class="keyword">public</span> ActionResult <span class="title">Login</span>(<span class="params"><span class="keyword">string</span> userName, <span class="keyword">string</span> password</span>)</span><br><span class="line"></span>{</span><br><span class="line">    <span class="comment">// 1. 建立 ticket</span></span><br><span class="line">    FormsAuthenticationTicket ticket = <span class="keyword">new</span> FormsAuthenticationTicket(<span class="number">1</span>,</span><br><span class="line">        userName,</span><br><span class="line">        DateTime.Now,</span><br><span class="line">        DateTime.Now.AddMinutes(<span class="number">30</span>), <span class="comment">// value of time out property</span></span><br><span class="line">        <span class="literal">false</span>, <span class="comment">// Value of IsPersistent property</span></span><br><span class="line">        <span class="string">"Extra Data"</span>,</span><br><span class="line">        FormsAuthentication.FormsCookiePath);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 加密 ticket</span></span><br><span class="line">    <span class="keyword">string</span> encryptedTicket = FormsAuthentication.Encrypt(ticket);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 建立 HttpCookie</span></span><br><span class="line">    HttpCookie authCookie = <span class="keyword">new</span> HttpCookie(</span><br><span class="line">                    FormsAuthentication.FormsCookieName,</span><br><span class="line">                    encryptedTicket);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. 使用者瀏覽器加入完成驗證的 Cookie</span></span><br><span class="line">    Response.Cookies.Add(authCookie);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> RedirectToAction(<span class="string">"Index"</span>, <span class="string">"Home"</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div></figure>
<h2 id="取得登入資訊"><a href="#取得登入資訊" class="headerlink" title="取得登入資訊"></a>取得登入資訊</h2><p>登入成功後，登入的相關資訊可以經由 Controller 的 IPrincipal User 取得<br><div class="figure " style="width:;"><a class="fancybox" href="IPrincipal.jpg" title="IPrincipal" data-fancybox-group=""><img class="fig-img" src="IPrincipal.jpg" alt="IPrincipal"></a><span class="caption">IPrincipal</span></div></p>
<p>簡單的取得登入使用者姓名以及是否驗證成功的方式</p>
<figure class="codeblock codeblock--tabbed"><figcaption><span>Authenticated</span><ul class="tabs"><li class="tab active">cs</li></ul></figcaption><div class="tabs-content"><figure class="highlight cs" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ActionResult <span class="title">Index</span>(<span class="params"></span>)</span><br><span class="line"></span>{</span><br><span class="line">    <span class="comment">// 取得登入者姓名</span></span><br><span class="line">    <span class="keyword">var</span> info = User.Identity.Name;</span><br><span class="line">    <span class="comment">// 是否驗證通過</span></span><br><span class="line">    <span class="keyword">bool</span> isAuthenticated = User.Identity.IsAuthenticated;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> View();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div></figure>
<p>將 Identity 轉型為 <code>FormsIdentity</code>，取得整個 <code>FormsAuthenticationTicket</code></p>
<figure class="codeblock codeblock--tabbed"><figcaption><span>FormsAuthenticationTicket</span><ul class="tabs"><li class="tab active">cs</li></ul></figcaption><div class="tabs-content"><figure class="highlight cs" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ActionResult <span class="title">GetFormsAuthenticationTicket</span>(<span class="params"></span>)        </span><br><span class="line"></span>{</span><br><span class="line">    FormsIdentity id = (FormsIdentity)User.Identity;</span><br><span class="line">    FormsAuthenticationTicket ticket = id.Ticket;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">string</span> cookiePath = ticket.CookiePath;</span><br><span class="line">    DateTime expiration = ticket.Expiration;</span><br><span class="line">    <span class="keyword">bool</span> expired = ticket.Expired;</span><br><span class="line">    <span class="keyword">bool</span> isPersistent = ticket.IsPersistent;</span><br><span class="line">    DateTime issueDate = ticket.IssueDate;</span><br><span class="line">    <span class="keyword">string</span> name = ticket.Name;</span><br><span class="line">    <span class="keyword">string</span> userData = ticket.UserData;</span><br><span class="line">    <span class="keyword">int</span> verstion = ticket.Version;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> View();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div></figure>
<h2 id="實作登出"><a href="#實作登出" class="headerlink" title="實作登出"></a>實作登出</h2><p>登出只要簡單一行程式碼就可以了 <code>FormsAuthentication.SignOut();</code><br><figure class="codeblock codeblock--tabbed"><figcaption><span>SignOut</span><ul class="tabs"><li class="tab active">cs</li></ul></figcaption><div class="tabs-content"><figure class="highlight cs" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ActionResult <span class="title">SignOut</span>(<span class="params"></span>)</span><br><span class="line"></span>{</span><br><span class="line">    FormsAuthentication.SignOut();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> RedirectToAction(<span class="string">"Index"</span>, <span class="string">"Home"</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div></figure></p>
<h3 id="參考"><a href="#參考" class="headerlink" title="參考"></a>參考</h3><p><strong>[<a href="https://blog.miniasp.com/post/2008/02/20/Explain-Forms-Authentication-in-ASPNET-20.aspx" title="簡介 ASP.NET 表單驗證 (FormsAuthentication) 的運作方式" target="_blank" rel="external">簡介 ASP.NET 表單驗證 (FormsAuthentication) 的運作方式</a>]</strong> <strong>[<a href="https://msdn.microsoft.com/en-us/library/aa480476.aspx" title="Explained: Forms Authentication in ASP.NET 2.0" target="_blank" rel="external">Explained: Forms Authentication in ASP.NET 2.0</a>]</strong> <strong>[<a href="https://msdn.microsoft.com/zh-tw/library/system.web.security.formsauthenticationticket.userdata.aspx" title="FormsAuthenticationTicket.UserData 屬性" target="_blank" rel="external">FormsAuthenticationTicket.UserData 屬性</a>]</strong> <strong>[<a href="https://app.pluralsight.com/player?course=mvc-applications-10-extension-points-improving&author=alex-wolf&name=mvc-applications-10-extension-points-improving-m10&clip=2&mode=live&start=89.741627&noteid=0c402383-86b5-4606-abc6-a9eea92dc6b5" title="Authorize Filter" target="_blank" rel="external">自訂 Authorize Filter</a>]</strong></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ASP.NET 提供了很方便帳號登入登出的驗證功能，今天就來說明一下，如何使用 ASP.NET 表單驗證(FormsAuthentication)，來完成登入、登出以及驗證功能。&lt;/p&gt;
    
    </summary>
    
      <category term="Authentication" scheme="https://mileslin.github.io/categories/Authentication/"/>
    
    
      <category term="Authentication" scheme="https://mileslin.github.io/tags/Authentication/"/>
    
      <category term="FormsAuthentication" scheme="https://mileslin.github.io/tags/FormsAuthentication/"/>
    
      <category term=".NET" scheme="https://mileslin.github.io/tags/NET/"/>
    
  </entry>
  
  <entry>
    <title>啟用 Action Filter Property Injection 與 註冊 Web Abstractions</title>
    <link href="https://mileslin.github.io/2017/07/%E5%95%9F%E7%94%A8-Action-Filter-Property-Injection-%E8%88%87-%E8%A8%BB%E5%86%8A-Web-Abstractions/"/>
    <id>https://mileslin.github.io/2017/07/啟用-Action-Filter-Property-Injection-與-註冊-Web-Abstractions/</id>
    <published>2017-07-22T15:02:16.000Z</published>
    <updated>2017-07-22T16:23:44.138Z</updated>
    
    <content type="html"><![CDATA[<ul>
<li>通常自動 Action Filter 的時候常常會用到一些資料庫的讀取，為了防止耦合性過高，所以建立取得 DBContext 實體的時候，可以用 DI 的方式注入。</li>
<li>MVC 會很常用到 HttpContextBase 、 RequestContext 等等之類功能，所以也建議這些也可以用 DI 的方式注入。</li>
</ul>
<a id="more"></a>
<p>簡短說明一下，此範例以 ASP.NET MVC5 為例，且在使用 Autofac 之前要先安裝 <a href="https://www.nuget.org/packages/Autofac.Mvc5/" title="Autofac.MVC5" target="_blank" rel="external">Autofac.MVC5</a>。  若完全不懂 DI 可以參考這篇 <a href="https://mileslin.github.io/2017/04/Autofac-%E8%A8%AD%E5%AE%9A-Web-API-Register-Controller-%E7%AD%86%E8%A8%98/" title="Autofac 設定 Web API Register Controller 筆記">Autofac 設定 Web API Register Controller 筆記</a> 或者參考 <a href="http://autofac.readthedocs.io/en/latest/integration/mvc.html#quick-start" title="Autofac 官方文件" target="_blank" rel="external">Autofac 官方文件</a>。</p>
<p>其實根據 <a href="http://autofac.readthedocs.io/en/latest/integration/mvc.html#quick-start" title="Autofac官方文件" target="_blank" rel="external">Autofac官方文件</a> ，已經說明得很清楚了，重點就 2 行程式碼</p>
<ul>
<li>註冊 Web abstraction class : <code>builder.RegisterModule&lt;AutofacWebTypesModule&gt;();</code></li>
<li>Action Filter 啟用 Property Injection : <code>builder.RegisterFilterProvider();</code></li>
</ul>
<figure class="codeblock codeblock--tabbed"><figcaption><span>Application_Start</span><ul class="tabs"><li class="tab active">cs</li></ul></figcaption><div class="tabs-content"><figure class="highlight" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">public class MvcApplication : System.Web.HttpApplication</span><br><span class="line">{</span><br><span class="line">    protected void Application_Start()</span><br><span class="line">    {</span><br><span class="line">        AreaRegistration.RegisterAllAreas();</span><br><span class="line">        FilterConfig.RegisterGlobalFilters(GlobalFilters.Filters);</span><br><span class="line">        RouteConfig.RegisterRoutes(RouteTable.Routes);</span><br><span class="line">        BundleConfig.RegisterBundles(BundleTable.Bundles);</span><br><span class="line"></span><br><span class="line">        // 開始建立 Container</span><br><span class="line">        var builder = new ContainerBuilder();</span><br><span class="line"></span><br><span class="line">        // Register your MVC controllers. (MvcApplication is the name of</span><br><span class="line">        // the class in Global.asax.)</span><br><span class="line">        builder.RegisterControllers(typeof(MvcApplication).Assembly);</span><br><span class="line"></span><br><span class="line">        builder.RegisterType&lt;DateService&gt;()</span><br><span class="line">                 .As&lt;IDateService&gt;()</span><br><span class="line">                 .InstancePerLifetimeScope();</span><br><span class="line"></span><br><span class="line">        // OPTIONAL: 註冊 web abstractions</span><br><span class="line">        builder.RegisterModule&lt;AutofacWebTypesModule&gt;();</span><br><span class="line"></span><br><span class="line">        // OPTIONAL: 啟用 property injection into action filters.</span><br><span class="line">        builder.RegisterFilterProvider();</span><br><span class="line"></span><br><span class="line">        // Set the dependency resolver to be Autofac.</span><br><span class="line">        var container = builder.Build();</span><br><span class="line">        DependencyResolver.SetResolver(new AutofacDependencyResolver(container));</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div></figure>
<h3 id="測試結果"><a href="#測試結果" class="headerlink" title="測試結果"></a>測試結果</h3><p>成功取得 HttpContextBase 實體<br><div class="figure " style="width:;"><a class="fancybox" href="InjectHttpContextBase.jpg" title="Inject HttpContextBase" data-fancybox-group=""><img class="fig-img" src="InjectHttpContextBase.jpg" alt="Inject HttpContextBase"></a><span class="caption">Inject HttpContextBase</span></div></p>
<p>成功 Property Injection<br><div class="figure " style="width:;"><a class="fancybox" href="PropertyInjection.jpg" title="Property Injection" data-fancybox-group=""><img class="fig-img" src="PropertyInjection.jpg" alt="Property Injection"></a><span class="caption">Property Injection</span></div></p>
<h3 id="AutofacWebTypesModule-註冊的-abstraction-classes"><a href="#AutofacWebTypesModule-註冊的-abstraction-classes" class="headerlink" title="AutofacWebTypesModule 註冊的 abstraction classes"></a>AutofacWebTypesModule 註冊的 abstraction classes</h3><p>註冊 <code>AutofacWebTypesModule</code> 會把很多 MVC 用到的 abstraction class 註冊進去，其中註冊了哪類別，可參考 <a href="http://autofac.readthedocs.io/en/latest/integration/mvc.html#register-web-abstractions" title="官方文件 - register web abstractions" target="_blank" rel="external">官方文件 - register web abstractions</a></p>
<h3 id="參考"><a href="#參考" class="headerlink" title="參考"></a>參考</h3><a href="http://autofac.readthedocs.io/en/latest/integration/mvc.html#mvc" title="Autofac" target="_blank" rel="external">Autofac</a>, <a href="https://github.com/autofac/Examples/blob/master/src/MvcExample/Global.asax.cs" title="Autofac 建立 Container git 範例" target="_blank" rel="external">Autofac 建立 Container git 範例</a>]]></content>
    
    <summary type="html">
    
      &lt;ul&gt;
&lt;li&gt;通常自動 Action Filter 的時候常常會用到一些資料庫的讀取，為了防止耦合性過高，所以建立取得 DBContext 實體的時候，可以用 DI 的方式注入。&lt;/li&gt;
&lt;li&gt;MVC 會很常用到 HttpContextBase 、 RequestContext 等等之類功能，所以也建議這些也可以用 DI 的方式注入。&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="Autofac" scheme="https://mileslin.github.io/categories/Autofac/"/>
    
    
      <category term=".NET" scheme="https://mileslin.github.io/tags/NET/"/>
    
      <category term="C#" scheme="https://mileslin.github.io/tags/C/"/>
    
      <category term="Autofac" scheme="https://mileslin.github.io/tags/Autofac/"/>
    
  </entry>
  
  <entry>
    <title>安裝 SQL Server 2014 Express 筆記</title>
    <link href="https://mileslin.github.io/2017/07/%E5%AE%89%E8%A3%9D-SQL-Server-2014-Express-%E7%AD%86%E8%A8%98/"/>
    <id>https://mileslin.github.io/2017/07/安裝-SQL-Server-2014-Express-筆記/</id>
    <published>2017-07-15T05:45:36.000Z</published>
    <updated>2017-07-15T06:50:15.436Z</updated>
    
    <content type="html"><![CDATA[<p>今天文章會說明，安裝 SQL Server Express 後，使用 Microsoft SQL Server Management Studio 的 sa 帳號登入。</p>
<a id="more"></a>
<h2 id="執行步驟"><a href="#執行步驟" class="headerlink" title="執行步驟"></a>執行步驟</h2><ol>
<li><p>下載安裝檔<br>首先我們要先去 <a href="https://www.microsoft.com/zh-tw/download/details.aspx?id=42299" title="Microsoft® SQL Server® 2014 Express" target="_blank" rel="external">Microsoft® SQL Server® 2014 Express</a> 下載安裝檔案，要選擇符合作業系統的安裝檔。</p>
<div class="figure " style="width:;"><a class="fancybox" href="Express_Version.jpg" title="x64" data-fancybox-group=""><img class="fig-img" src="Express_Version.jpg" alt="x64"></a><span class="caption">x64</span></div>
</li>
<li><p>執行安裝<br>下載完畢後，執行安裝，會看到這個畫面，然後點選「新增 SQL Server 獨立安裝或將功能加入至現有安裝」</p>
<div class="figure " style="width:;"><a class="fancybox" href="Add_SQL_Server.jpg" title="Add SQL Server" data-fancybox-group=""><img class="fig-img" src="Add_SQL_Server.jpg" alt="Add SQL Server"></a><span class="caption">Add SQL Server</span></div>
</li>
<li><p>選擇新安裝<br>在前幾個步驟安裝程式會做一些檢查，然後會直接來到「安裝類型」的步驟，選擇 「執行 SQL Server 2014 的新安裝」，點選下一步</p>
<div class="figure " style="width:;"><a class="fancybox" href="New_Install.jpg" title="New Install" data-fancybox-group=""><img class="fig-img" src="New_Install.jpg" alt="New Install"></a><span class="caption">New Install</span></div>
</li>
<li><p>「特徵選取」，選擇要安裝的項目，以及執行個體的路徑</p>
</li>
<li><p>執行個體組態<br>設定具名執行個體，或者使用預設執行個體。 執行個體名稱要記錄起來，因為這是安裝完畢後，要連線的<span class="highlight-text primary">伺服器名稱</span><div class="figure " style="width:;"><a class="fancybox" href="執行個體組態.jpg" title="執行個體組態" data-fancybox-group=""><img class="fig-img" src="執行個體組態.jpg" alt="執行個體組態"></a><span class="caption">執行個體組態</span></div></p>
</li>
<li><p>伺服器組態<br>請確認 SQL Server Database Engine 啟動類型為自動，這樣安裝完才會執行啟動。</p>
<div class="figure " style="width:;"><a class="fancybox" href="伺服器組態.jpg" title="伺服器組態" data-fancybox-group=""><img class="fig-img" src="伺服器組態.jpg" alt="伺服器組態"></a><span class="caption">伺服器組態</span></div>
</li>
<li><p>資料庫引擎組態<br>請選擇 「混合模式」，並輸入密碼，此密碼的預設帳號是 <span class="highlight-text primary">sa</span><div class="figure " style="width:;"><a class="fancybox" href="資料庫引擎組態.jpg" title="資料庫引擎組態" data-fancybox-group=""><img class="fig-img" src="資料庫引擎組態.jpg" alt="資料庫引擎組態"></a><span class="caption">資料庫引擎組態</span></div></p>
</li>
<li><p>接下來就一直下一步，完成安裝。</p>
</li>
<li><p>開啟 「SQL Server 2014 組態管理員」，確定是否建立成功</p>
<div class="figure " style="width:;"><a class="fancybox" href="確認服務已啟動.jpg" title="確認服務已啟動" data-fancybox-group=""><img class="fig-img" src="確認服務已啟動.jpg" alt="確認服務已啟動"></a><span class="caption">確認服務已啟動</span></div>
</li>
<li><p>使用 SSMS 連接資料庫</p>
<ul>
<li><p>選擇伺服器</p>
<div class="figure " style="width:;"><a class="fancybox" href="選擇伺服器.jpg" title="選擇伺服器" data-fancybox-group=""><img class="fig-img" src="選擇伺服器.jpg" alt="選擇伺服器"></a><span class="caption">選擇伺服器</span></div>
</li>
<li><p>選擇剛剛建立的伺服器</p>
<div class="figure " style="width:;"><a class="fancybox" href="選擇SQLEXPRESS.jpg" title="選擇 SQLEXPRESS" data-fancybox-group=""><img class="fig-img" src="選擇SQLEXPRESS.jpg" alt="選擇 SQLEXPRESS"></a><span class="caption">選擇 SQLEXPRESS</span></div>
</li>
<li><p>輸入剛剛安裝時候，輸入的密碼，帳號預設是 <span class="highlight-text primary">sa</span></p>
<div class="figure " style="width:;"><a class="fancybox" href="輸入帳號密碼.jpg" title="輸入帳號密碼" data-fancybox-group=""><img class="fig-img" src="輸入帳號密碼.jpg" alt="輸入帳號密碼"></a><span class="caption">輸入帳號密碼</span></div>
</li>
<li><p>連線成功</p>
<div class="figure " style="width:;"><a class="fancybox" href="連線成功.jpg" title="連線成功" data-fancybox-group=""><img class="fig-img" src="連線成功.jpg" alt="連線成功"></a><span class="caption">連線成功</span></div>
</li>
</ul>
</li>
</ol>
<h3 id="參考"><a href="#參考" class="headerlink" title="參考"></a>參考</h3><a href="https://www.youtube.com/watch?v=E_zFM7mzFUg" title="How to Install SQL Server 2014 Express and SQL Server Management Studio 2014 Express" target="_blank" rel="external">How to Install SQL Server 2014 Express and SQL Server Management Studio 2014 Express</a>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;今天文章會說明，安裝 SQL Server Express 後，使用 Microsoft SQL Server Management Studio 的 sa 帳號登入。&lt;/p&gt;
    
    </summary>
    
      <category term="SQL" scheme="https://mileslin.github.io/categories/SQL/"/>
    
    
      <category term="SQL" scheme="https://mileslin.github.io/tags/SQL/"/>
    
  </entry>
  
  <entry>
    <title>Command Line 筆記-遠端複製與壓縮</title>
    <link href="https://mileslin.github.io/2017/07/Command-Line-%E7%AD%86%E8%A8%98-%E9%81%A0%E7%AB%AF%E8%A4%87%E8%A3%BD%E8%88%87%E5%A3%93%E7%B8%AE/"/>
    <id>https://mileslin.github.io/2017/07/Command-Line-筆記-遠端複製與壓縮/</id>
    <published>2017-07-11T09:34:08.000Z</published>
    <updated>2017-07-15T05:44:43.738Z</updated>
    
    <content type="html"><![CDATA[<p>最近為了將的壓縮、解壓縮、遠端連線硬碟、複製貼上等等的繁瑣的事情寫成 bat 檔案，花了很多時間。  所以就來記錄一下，用 command line 自動化的功能。</p>
<ul>
<li>刪除整個資料夾、刪除單一檔案</li>
<li>使用 msbuild 建立佈署檔案</li>
<li>複製遠端硬碟的檔案、複製貼上整個資夾並自動取代現有檔案</li>
<li>使用 PowerShell 壓縮與解壓縮檔案</li>
<li>檢查檔案是否存在，並且執行不同指令</li>
</ul>
<a id="more"></a>
<h2 id="刪除整個資料夾、刪除單一檔案"><a href="#刪除整個資料夾、刪除單一檔案" class="headerlink" title="刪除整個資料夾、刪除單一檔案"></a>刪除整個資料夾、刪除單一檔案</h2><p>刪除整個資料夾<br><figure class="codeblock codeblock--tabbed"><figcaption><span>Delete Entire Folder</span><ul class="tabs"><li class="tab active">bat</li></ul></figcaption><div class="tabs-content"><figure class="highlight bat" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">del</span> /q "D:\Projects\Publish\Today_Deploy\*"</span><br><span class="line"><span class="keyword">FOR</span> /D <span class="variable">%%p</span> <span class="keyword">IN</span> ("D:\Projects\Publish\Today_Deploy\*.*") <span class="keyword">DO</span> <span class="built_in">rmdir</span> "<span class="variable">%%p</span>" /s /q</span><br><span class="line"><span class="built_in">rmdir</span> "D:\Projects\Publish\Today_Deploy"</span><br></pre></td></tr></tbody></table></figure></div></figure></p>
<p>刪除單一檔案<br><figure class="codeblock codeblock--tabbed"><figcaption><span>Delete a file</span><ul class="tabs"><li class="tab active">bat</li></ul></figcaption><div class="tabs-content"><figure class="highlight bat" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">del</span> D:\Projects\Publish\Today_Deploy\WebAPI\Web.config</span><br></pre></td></tr></tbody></table></figure></div></figure></p>
<h2 id="使用-msbuild-建立佈署檔案"><a href="#使用-msbuild-建立佈署檔案" class="headerlink" title="使用 msbuild 建立佈署檔案"></a>使用 msbuild 建立佈署檔案</h2><figure class="codeblock codeblock--tabbed"><figcaption><span>Web Deploy</span><ul class="tabs"><li class="tab active">bat</li></ul></figcaption><div class="tabs-content"><figure class="highlight bat" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">"C:\Program Files (x86)\MSBuild\<span class="number">14</span>.<span class="number">0</span>\Bin\MSBuild.exe" "D:\Projects\WebAPI\Project.WebAPI.sln" </span><br><span class="line">/p:Configuration=Release </span><br><span class="line">/p:DeployOnBuild=True </span><br><span class="line">/p:DeployDefaultTarget=WebPublish  </span><br><span class="line">/p:WebPublishMethod=FileSystem </span><br><span class="line">/p:DeleteExistingFiles=True  </span><br><span class="line">/p:publishUrl=D:\Projects\Publish\Today_Deploy\WebAPI</span><br></pre></td></tr></tbody></table></figure></div></figure>
<h2 id="複製遠端硬碟的檔案、複製貼上整個資夾並自動取代現有檔案"><a href="#複製遠端硬碟的檔案、複製貼上整個資夾並自動取代現有檔案" class="headerlink" title="複製遠端硬碟的檔案、複製貼上整個資夾並自動取代現有檔案"></a>複製遠端硬碟的檔案、複製貼上整個資夾並自動取代現有檔案</h2><p>因為佈署都會連到廠商的VM主機，而且桌面遠端連線那邊的設定，我 D 磁碟有開分享，所以可以從廠商的 VM 直接連到我這邊的 D 磁碟。  因為可以直接連到 D 磁碟，所以也可以用 command line 的方式來複製我要的檔案，只要使用 <code>\\tsclient\d</code> 就可以指定到我電腦的路徑 ， \tsclient 是指我這邊的電腦，而 \d 表示我的 D 磁碟。<br><figure class="codeblock codeblock--tabbed"><figcaption><span>tsclient copy</span><ul class="tabs"><li class="tab active">bat</li></ul></figcaption><div class="tabs-content"><figure class="highlight bat" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">XCOPY</span> \\tsclient\d\Projects\Publish\Today_Deploy.zip D:\Project\ /Y</span><br></pre></td></tr></tbody></table></figure></div></figure></p>
<p>將我要佈署的整個資料夾含檔案，貼到主機上 server 的資料夾<br><figure class="codeblock codeblock--tabbed"><figcaption><span>tsclient copy</span><ul class="tabs"><li class="tab active">bat</li></ul></figcaption><div class="tabs-content"><figure class="highlight bat" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">XCOPY</span> D:\Project\Today_Deploy\WebAPI\* D:\Project\WebAPI /s /i /Y</span><br></pre></td></tr></tbody></table></figure></div></figure></p>
<h2 id="使用-PowerShell-壓縮與解壓縮檔案"><a href="#使用-PowerShell-壓縮與解壓縮檔案" class="headerlink" title="使用 PowerShell 壓縮與解壓縮檔案"></a>使用 PowerShell 壓縮與解壓縮檔案</h2><p>使用 PowerShell 壓縮或解壓縮檔案的話要先把 PowerShell 要執行的 script 先寫好，然後 command 呼叫 <code>Powershell.exe</code> 指定要執行的 script ，在設定一些執行參數就可以了。</p>
<h3 id="壓縮"><a href="#壓縮" class="headerlink" title="壓縮"></a>壓縮</h3><figure class="codeblock codeblock--tabbed"><figcaption><span>zip</span><ul class="tabs"><li class="tab active">ps1</li><li class="tab">bat</li></ul></figcaption><div class="tabs-content"><figure class="highlight plain" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$source = "D:\Projects\Publish\Today_Deploy"</span><br><span class="line">$destination = "D:\Projects\Publish\Today_Deploy.zip"</span><br><span class="line">If(Test-path $destination) {Remove-item $destination}</span><br><span class="line">Add-Type -assembly "system.io.compression.filesystem"</span><br><span class="line">[io.compression.zipfile]::CreateFromDirectory($source,$destination)</span><br></pre></td></tr></tbody></table></figure><figure class="highlight bat" style="display: none;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Powershell.exe -executionpolicy remotesigned -File  D:\Projects\zip.ps1</span><br></pre></td></tr></tbody></table></figure></div></figure>
<h3 id="解壓縮"><a href="#解壓縮" class="headerlink" title="解壓縮"></a>解壓縮</h3><figure class="codeblock codeblock--tabbed"><figcaption><span>unzip</span><ul class="tabs"><li class="tab active">ps1</li><li class="tab">bat</li></ul></figcaption><div class="tabs-content"><figure class="highlight plain" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Add-Type -AssemblyName System.IO.Compression.FileSystem</span><br><span class="line">function Unzip</span><br><span class="line">{</span><br><span class="line">    param([string]$zipfile, [string]$outpath)</span><br><span class="line"></span><br><span class="line">    [System.IO.Compression.ZipFile]::ExtractToDirectory($zipfile, $outpath)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">Unzip "D:\TraPacWebPayment\Today_Deploy.zip" "D:\TraPacWebPayment\Today_Deploy"</span><br></pre></td></tr></tbody></table></figure><figure class="highlight bat" style="display: none;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Powershell.exe -executionpolicy remotesigned -File  D:\Project\unzip.ps1</span><br></pre></td></tr></tbody></table></figure></div></figure>
<h2 id="檢查檔案是否存在，並且執行不同指令"><a href="#檢查檔案是否存在，並且執行不同指令" class="headerlink" title="檢查檔案是否存在，並且執行不同指令"></a>檢查檔案是否存在，並且執行不同指令</h2><p>command line 有檢查檔案是否存在的指令，若檔案不存在，可以用 goto: 的方式直接跳到要指定執行的指令。<br>如以下指令，會判斷 <code>D:\Project\Today_Deploy.zip</code> 是否存在，若不存在則跳到 <code>:exit</code> 的點去執行，所以  do something… 就不會執行到。<br><figure class="codeblock codeblock--tabbed"><figcaption><span>check file exist</span><ul class="tabs"><li class="tab active">bat</li></ul></figcaption><div class="tabs-content"><figure class="highlight bat" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">@rem check file exits or not</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> <span class="keyword">exist</span> D:\Project\Today_Deploy.zip <span class="keyword">goto</span> :<span class="keyword">exit</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">do</span> something...</span><br><span class="line"></span><br><span class="line">:<span class="keyword">exit</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> deployment file: D:\Project\Today_Deploy.zip <span class="keyword">not</span> exists</span><br></pre></td></tr></tbody></table></figure></div></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;最近為了將的壓縮、解壓縮、遠端連線硬碟、複製貼上等等的繁瑣的事情寫成 bat 檔案，花了很多時間。  所以就來記錄一下，用 command line 自動化的功能。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;刪除整個資料夾、刪除單一檔案&lt;/li&gt;
&lt;li&gt;使用 msbuild 建立佈署檔案&lt;/li&gt;
&lt;li&gt;複製遠端硬碟的檔案、複製貼上整個資夾並自動取代現有檔案&lt;/li&gt;
&lt;li&gt;使用 PowerShell 壓縮與解壓縮檔案&lt;/li&gt;
&lt;li&gt;檢查檔案是否存在，並且執行不同指令&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="cmd" scheme="https://mileslin.github.io/categories/cmd/"/>
    
    
      <category term="cmd" scheme="https://mileslin.github.io/tags/cmd/"/>
    
      <category term="PowerShell" scheme="https://mileslin.github.io/tags/PowerShell/"/>
    
      <category term="msbuild" scheme="https://mileslin.github.io/tags/msbuild/"/>
    
  </entry>
  
  <entry>
    <title>ng build 並壓縮檔案</title>
    <link href="https://mileslin.github.io/2017/07/ng-build-%E4%B8%A6%E5%A3%93%E7%B8%AE%E6%AA%94%E6%A1%88/"/>
    <id>https://mileslin.github.io/2017/07/ng-build-並壓縮檔案/</id>
    <published>2017-07-10T11:19:27.000Z</published>
    <updated>2017-07-15T05:44:43.740Z</updated>
    
    <content type="html"><![CDATA[<p>在佈署 Angular 專案的時候為了能夠快速複製到遠端主機上，所以通常會 <code>ng build</code> 後，將 build 出來的檔案壓縮，要完成這一連串的流程，通常都是寫 cmd 來處理。</p>
<a id="more"></a>
<h2 id="使用-PowerShell-壓縮資料夾"><a href="#使用-PowerShell-壓縮資料夾" class="headerlink" title="使用 PowerShell 壓縮資料夾"></a>使用 PowerShell 壓縮資料夾</h2><p>命令提示字元預設是沒有將資料夾壓縮的功能，所以我這邊使用 PowerShell 幫我處理壓縮檔案。</p>
<ol>
<li>建立 zip.ps1 檔案</li>
<li>貼上底下的程式碼。 <span class="highlight-text primary">記得修改$source與$destination的路徑</span><figure class="codeblock codeblock--tabbed"><figcaption><span>zip.ps1</span><ul class="tabs"><li class="tab active">ps1</li></ul></figcaption><div class="tabs-content"><figure class="highlight plain" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$source = "D:\Projects\Publish\Today_Deploy"</span><br><span class="line">$destination = "D:\Projects\Publish\Today_Deploy.zip"</span><br><span class="line">If(Test-path $destination) {Remove-item $destination}</span><br><span class="line">Add-Type -assembly "system.io.compression.filesystem"</span><br><span class="line">[io.compression.zipfile]::CreateFromDirectory($source,$destination)</span><br></pre></td></tr></tbody></table></figure></div></figure>
</li>
</ol>
<p>之後命令提示字元只要使用 PowerShell 呼叫這個 script 檔案，就可以將檔案壓縮。<br><code>Powershell.exe -executionpolicy remotesigned -File  D:\Projects\zip.ps1</code></p>
<h2 id="結合-ng-build-與壓縮指令"><a href="#結合-ng-build-與壓縮指令" class="headerlink" title="結合 ng build 與壓縮指令"></a>結合 ng build 與壓縮指令</h2><p>建立一個 deploy.bat 檔案，貼上底下的指令</p>
<ol>
<li>將路徑指定到 Angular 的根目錄</li>
<li>執行 ng build 並將輸出到 F2E 資料夾</li>
<li>執行壓縮</li>
</ol>
<figure class="codeblock codeblock--tabbed"><figcaption><span>deploy.bat</span><ul class="tabs"><li class="tab active">bat</li></ul></figcaption><div class="tabs-content"><figure class="highlight bat" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /d D:\Projects\Trapac_Web_Payment\TraPacWebPayment.F2EWeb</span><br><span class="line"></span><br><span class="line">ng build --prod --output-<span class="built_in">path</span>=D:\Projects\Publish\Today_Deploy\F2E</span><br><span class="line"></span><br><span class="line">Powershell.exe -executionpolicy remotesigned -File  D:\Projects\zip.ps1</span><br></pre></td></tr></tbody></table></figure></div></figure>
<p><strong>結果:事情不會這麼順利的 !!!!</strong><br><div class="alert danger no-icon"><p>ng build 後，會把命令提示字元關掉，會造成第3行壓縮指令沒有執行 !!!</p>
</div></p>
<h2 id="拆成-3-個-bat，讓後續指令能繼續進行"><a href="#拆成-3-個-bat，讓後續指令能繼續進行" class="headerlink" title="拆成 3 個 bat，讓後續指令能繼續進行"></a>拆成 3 個 bat，讓後續指令能繼續進行</h2><ol>
<li><p>建立 build.bat 貼上前 2 行指令</p>
<figure class="codeblock codeblock--tabbed"><figcaption><span>build.bat</span><ul class="tabs"><li class="tab active">bat</li></ul></figcaption><div class="tabs-content"><figure class="highlight bat" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /d D:\Projects\Trapac_Web_Payment\TraPacWebPayment.F2EWeb</span><br><span class="line"></span><br><span class="line">ng build --prod --output-<span class="built_in">path</span>=D:\Projects\Publish\Today_Deploy\F2E</span><br></pre></td></tr></tbody></table></figure></div></figure>
</li>
<li><p>建立 zip.bat 貼上第 3 行指令</p>
<figure class="codeblock codeblock--tabbed"><figcaption><span>zip.bat</span><ul class="tabs"><li class="tab active">bat</li></ul></figcaption><div class="tabs-content"><figure class="highlight bat" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Powershell.exe -executionpolicy remotesigned -File  D:\Projects\zip.ps1</span><br></pre></td></tr></tbody></table></figure></div></figure>
</li>
<li><p>修改 deploy.bat ，呼叫 build.bat 與 zip.bat</p>
<figure class="codeblock codeblock--tabbed"><figcaption><span>deploy.bat</span><ul class="tabs"><li class="tab active">bat</li></ul></figcaption><div class="tabs-content"><figure class="highlight bat" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">call</span> D:\Projects\build.bat</span><br><span class="line"></span><br><span class="line"><span class="keyword">call</span> D:\Projects\zip.bat</span><br></pre></td></tr></tbody></table></figure></div></figure>
</li>
<li><p>執行 deploy.bat，用這種方式，就順利讓 <code>ng build</code> 之後還可以持續執行指令</p>
</li>
</ol>
<h3 id="小結"><a href="#小結" class="headerlink" title="小結"></a>小結</h3><p>目前就自己研究出這種方式，可以讓 <code>ng build</code> 後，可持續執行後面的指令，如果讀者還有更好的方式，歡迎告知。</p>
<h3 id="參考"><a href="#參考" class="headerlink" title="參考"></a>參考</h3><a href="https://blogs.technet.microsoft.com/heyscriptingguy/2015/03/09/use-powershell-to-create-zip-archive-of-folder/" title="use-powershell-to-create-zip" target="_blank" rel="external">use-powershell-to-create-zip</a>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;在佈署 Angular 專案的時候為了能夠快速複製到遠端主機上，所以通常會 &lt;code&gt;ng build&lt;/code&gt; 後，將 build 出來的檔案壓縮，要完成這一連串的流程，通常都是寫 cmd 來處理。&lt;/p&gt;
    
    </summary>
    
      <category term="Angular" scheme="https://mileslin.github.io/categories/Angular/"/>
    
    
      <category term="Angular CLI" scheme="https://mileslin.github.io/tags/Angular-CLI/"/>
    
      <category term="Angular" scheme="https://mileslin.github.io/tags/Angular/"/>
    
  </entry>
  
  <entry>
    <title>Angular CLI 實用小技巧 4</title>
    <link href="https://mileslin.github.io/2017/07/Angular-CLI-%E5%AF%A6%E7%94%A8%E5%B0%8F%E6%8A%80%E5%B7%A7-4/"/>
    <id>https://mileslin.github.io/2017/07/Angular-CLI-實用小技巧-4/</id>
    <published>2017-07-09T04:26:50.000Z</published>
    <updated>2017-07-09T08:15:21.605Z</updated>
    
    <content type="html"><![CDATA[<ul>
<li>unit tests<ul>
<li>使用 NO_ERROR SCHEMA 處理 known element 問題</li>
</ul>
</li>
<li>end to end tests</li>
<li>如何 debug 測試</li>
</ul>
<a id="more"></a>
<h2 id="執行單元測試"><a href="#執行單元測試" class="headerlink" title="執行單元測試"></a>執行單元測試</h2><p>驗證程式碼的執行邏輯是否如預期。</p>
<div class="alert info no-icon"><p>ng test</p>
</div>
<table>
<thead>
<tr>
<th style="text-align:left">Options</th>
<th style="text-align:left">Alias</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">--code-coverage</td>
<td style="text-align:left">-cc</td>
<td style="text-align:left">建立 code coverage report</td>
</tr>
<tr>
<td style="text-align:left">--coloers</td>
<td style="text-align:left"></td>
<td style="text-align:left">命令提示字元的輸出文字是否要彩色<em>(預設: true)</em></td>
</tr>
<tr>
<td style="text-align:left">--single-run</td>
<td style="text-align:left">-sr</td>
<td style="text-align:left">執行一次測試，輸出結果後就結束，會在 CI 的時候用到 <em>(預設: false)</em></td>
</tr>
<tr>
<td style="text-align:left">--progress</td>
<td style="text-align:left"></td>
<td style="text-align:left">Log grogress to console <em>(預設: true(</em></td>
</tr>
<tr>
<td style="text-align:left">--sourcemaps</td>
<td style="text-align:left">-sm</td>
<td style="text-align:left">可用來 debug test <em>(預設: true)</em></td>
</tr>
<tr>
<td style="text-align:left">--watch</td>
<td style="text-align:left">-w</td>
<td style="text-align:left">偵測檔案變更，並重新執行測試 <em>(預設: true)</em></td>
</tr>
</tbody>
</table>
<h2 id="debug-測試"><a href="#debug-測試" class="headerlink" title="debug 測試"></a>debug 測試</h2><p>在執行 <code>ng test</code> 後，會開啟瀏覽器，顯示測試結果，在測試結果的右上角點選 DEBUG 按鈕，會導向到 Debug 頁面。<br><div class="figure " style="width:;"><a class="fancybox" href="Debug_Index.jpg" title="Debug Button" data-fancybox-group=""><img class="fig-img" src="Debug_Index.jpg" alt="Debug Button"></a><span class="caption">Debug Button</span></div></p>
<p>在 Debug 頁面，開啟開發者工具<em>(F12)</em>，點選 <strong>Source</strong>。<br><div class="figure " style="width:;"><a class="fancybox" href="debug_dev.jpg" title="chrome 開發者工具" data-fancybox-group=""><img class="fig-img" src="debug_dev.jpg" alt="chrome 開發者工具"></a><span class="caption">chrome 開發者工具</span></div></p>
<p>點選快捷鍵 <code>ctrl + p</code>，選取要 debug 的檔案 =&gt; 下中斷點 =&gt; 重新整理網頁，就可以 Debug 測試的程式碼了。<br><div class="figure " style="width:;"><a class="fancybox" href="dev_debug.gif" title="debug" data-fancybox-group=""><img class="fig-img" src="dev_debug.gif" alt="debug"></a><span class="caption">debug</span></div></p>
<h3 id="處理-router-outlet-is-not-a-known-element"><a href="#處理-router-outlet-is-not-a-known-element" class="headerlink" title="處理 router-outlet is not a known element"></a>處理 router-outlet is not a known element</h3><p>Angular 在建立其他 Module <em>(ex: admin.module)</em>，且 Componet 有使用 <code>&lt;router-outlet&gt;&lt;/router-outlet&gt;</code><br><div class="figure " style="width:;"><a class="fancybox" href="admin_folder.jpg" title="" data-fancybox-group=""><img class="fig-img" src="admin_folder.jpg" alt=""></a></div><br><div class="figure " style="width:;"><a class="fancybox" href="router_outlet.jpg" title="" data-fancybox-group=""><img class="fig-img" src="router_outlet.jpg" alt=""></a></div></p>
<p>在什麼都不設定的情況下，跑測試<em>(ng test)</em>，會出現測試失敗的情形，如下。<br><div class="figure " style="width:;"><a class="fancybox" href="router_outlet_unknown.jpg" title="router_outlet_unknown" data-fancybox-group=""><img class="fig-img" src="router_outlet_unknown.jpg" alt="router_outlet_unknown"></a><span class="caption">router_outlet_unknown</span></div></p>
<p>看錯誤訊息可以知道是在跑 AdminComponent 的時候發生失敗的，這時候在 <code>admin.component.spec.ts</code>，加上 <span class="highlight-text primary">NO_ERRORS_SCHEMA</span>，就可以解決這個問題。<br><div class="figure " style="width:;"><a class="fancybox" href="NO_ERRORS_SCHEMA.jpg" title="NO_ERRORS_SCHEMA" data-fancybox-group=""><img class="fig-img" src="NO_ERRORS_SCHEMA.jpg" alt="NO_ERRORS_SCHEMA"></a><span class="caption">NO_ERRORS_SCHEMA</span></div></p>
<h2 id="End-to-End-Tests"><a href="#End-to-End-Tests" class="headerlink" title="End to End Tests"></a>End to End Tests</h2><p>End to End Tests 模仿使用者與網頁互動的方式，來驗證功能是否正確。  而 Angular CLI 使用 <a href="http://www.protractortest.org/#/" title="Protractor" target="_blank" rel="external">Protractor</a> 來處理 e2e tests ，且會開啟瀏覽器執行。</p>
<div class="alert info no-icon"><p>ng e2e</p>
</div>
<table>
<thead>
<tr>
<th style="text-align:left">Options</th>
<th style="text-align:left">Alias</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">--config</td>
<td style="text-align:left">-c</td>
<td style="text-align:left">指定 conf.js <em>(預設:專案根目錄下的 protractor.conf.js)</em></td>
</tr>
<tr>
<td style="text-align:left">--element-explorer</td>
<td style="text-align:left">-ee</td>
<td style="text-align:left">開啟 protractor’s element explorer ，用於 debug</td>
</tr>
<tr>
<td style="text-align:left">--serve</td>
<td style="text-align:left">-s</td>
<td style="text-align:left">編譯並啟動伺服器<em>(預設: true)</em></td>
</tr>
<tr>
<td style="text-align:left">--specs</td>
<td style="text-align:left">-sp</td>
<td style="text-align:left">可指定要執行的 e2e.spec <em>(預設: 全部執行)</em></td>
</tr>
<tr>
<td style="text-align:left">--webdriver-update</td>
<td style="text-align:left">-wu</td>
<td style="text-align:left">update webdriver <em>(預設: true)</em></td>
</tr>
</tbody>
</table>
<h2 id="End-to-End-Tests-Debug"><a href="#End-to-End-Tests-Debug" class="headerlink" title="End to End Tests Debug"></a>End to End Tests Debug</h2><p>執行 <code>ng e2e -ee</code> 會看到開啟的瀏覽器停在測試的那一頁，而且命令提示字元是可以輸入指令的狀態，這時候就可以用命令提示字元 debug。</p>
<p>例如，我現在的頁面是停在首頁，頁面只有簡單的 <span class="highlight-text primary">app works! </span><br><div class="figure " style="width:;"><a class="fancybox" href="e2e_index.jpg" title="e2e_index" data-fancybox-group=""><img class="fig-img" src="e2e_index.jpg" alt="e2e_index"></a><span class="caption">e2e_index</span></div></p>
<p>這時候我們就可以在命令提示字元，用 css selector 的方式取得 h1 的文字內容<br><div class="figure " style="width:;"><a class="fancybox" href="css_selector.jpg" title="" data-fancybox-group=""><img class="fig-img" src="css_selector.jpg" alt=""></a></div></p>
<p>又或者可用 <a href="http://www.protractortest.org/#/" title="Protractor" target="_blank" rel="external">Protractor</a> 提供的 element 取得文字內容<br><div class="figure " style="width:;"><a class="fancybox" href="element_debug.jpg" title="" data-fancybox-group=""><img class="fig-img" src="element_debug.jpg" alt=""></a></div></p>
<p>用以上的方式就可以來 debug 頁面上顯示的資訊是不是如預期的。</p>
]]></content>
    
    <summary type="html">
    
      &lt;ul&gt;
&lt;li&gt;unit tests&lt;ul&gt;
&lt;li&gt;使用 NO_ERROR SCHEMA 處理 known element 問題&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;end to end tests&lt;/li&gt;
&lt;li&gt;如何 debug 測試&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="Angular" scheme="https://mileslin.github.io/categories/Angular/"/>
    
    
      <category term="Angular CLI" scheme="https://mileslin.github.io/tags/Angular-CLI/"/>
    
      <category term="Angular" scheme="https://mileslin.github.io/tags/Angular/"/>
    
  </entry>
  
  <entry>
    <title>Angular CLI 實用小技巧 3</title>
    <link href="https://mileslin.github.io/2017/07/Angular-CLI-%E5%AF%A6%E7%94%A8%E5%B0%8F%E6%8A%80%E5%B7%A7-3/"/>
    <id>https://mileslin.github.io/2017/07/Angular-CLI-實用小技巧-3/</id>
    <published>2017-07-08T15:07:00.000Z</published>
    <updated>2017-07-15T05:44:43.703Z</updated>
    
    <content type="html"><![CDATA[<ul>
<li>建置專案與環境參數設定</li>
</ul>
<a id="more"></a>
<h2 id="Build-與-Environment"><a href="#Build-與-Environment" class="headerlink" title="Build 與 Environment"></a>Build 與 Environment</h2><p><code>build</code> 可將 Angular 專案打包，之後可以佈署到 server 上，而 <code>environment</code> 是用來設定一些 Angular 會用到的參數，例如: 開發時的 host 是 <a href="http://dev/" target="_blank" rel="external">http://dev/</a> ， production host 是 <a href="http://prod/" target="_blank" rel="external">http://prod/</a> ，就可以將參數寫在 environment.ts。<br><div class="figure " style="width:;"><a class="fancybox" href="environments_setting.jpg" title="environment" data-fancybox-group=""><img class="fig-img" src="environments_setting.jpg" alt="environment"></a><span class="caption">environment</span></div></p>
<h3 id="比較-Dev-Build-與-Prod-Build"><a href="#比較-Dev-Build-與-Prod-Build" class="headerlink" title="比較 Dev Build 與 Prod Build:"></a>比較 Dev Build 與 Prod Build:</h3><table>
<thead>
<tr>
<th style="text-align:left">說明</th>
<th style="text-align:left">ng build</th>
<th style="text-align:left">ng build --prod</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">使用的 Environment 檔案 <div class="figure " style="width:;"><a class="fancybox" href="environments_folder.jpg" title="" data-fancybox-group=""><img class="fig-img" src="environments_folder.jpg" alt=""></a></div></td>
<td style="text-align:left">environment.ts</td>
<td style="text-align:left">environment.prod.ts</td>
</tr>
<tr>
<td style="text-align:left">不要讓檔案被 Cache <em>(Cache-busting)</em></td>
<td style="text-align:left">只有 css 檔案參考到的圖檔</td>
<td style="text-align:left">所有檔案</td>
</tr>
<tr>
<td style="text-align:left">Source maps</td>
<td style="text-align:left">建立</td>
<td style="text-align:left">不建立</td>
</tr>
<tr>
<td style="text-align:left">Extracted CSS</td>
<td style="text-align:left">global CSS output to .js</td>
<td style="text-align:left">yes, to css files</td>
</tr>
<tr>
<td style="text-align:left">醜化 <em>(Uglification)</em></td>
<td style="text-align:left">無</td>
<td style="text-align:left">有</td>
</tr>
<tr>
<td style="text-align:left">移除沒用到的程式碼 <em>(Tree-Shaking)</em></td>
<td style="text-align:left">無</td>
<td style="text-align:left">有</td>
</tr>
<tr>
<td style="text-align:left">Ahead of time compilation <em>AOT</em></td>
<td style="text-align:left">無</td>
<td style="text-align:left">有</td>
</tr>
<tr>
<td style="text-align:left">Bundling</td>
<td style="text-align:left">有</td>
<td style="text-align:left">有</td>
</tr>
</tbody>
</table>
<h3 id="dev-ng-build-參數設定小技巧"><a href="#dev-ng-build-參數設定小技巧" class="headerlink" title="dev ng build 參數設定小技巧"></a>dev ng build 參數設定小技巧</h3><p><em>這四行執行結果都一樣</em><br><div class="alert info no-icon"><p>ng build --target=development --environment=dev<br>ng build --dev -e=dev<br>ng build --dev<br>ng build</p>
</div></p>
<h3 id="prod-ng-build-參數設定小技巧"><a href="#prod-ng-build-參數設定小技巧" class="headerlink" title="prod ng build 參數設定小技巧"></a>prod ng build 參數設定小技巧</h3><p><em>這三行執行結果都一樣</em><br><div class="alert info no-icon"><p>ng build --target=production --environment=prod<br>ng build --prod -e=prod<br>ng build --prod</p>
</div></p>
<h3 id="ng-build-其他參數設定"><a href="#ng-build-其他參數設定" class="headerlink" title="ng build 其他參數設定"></a>ng build 其他參數設定</h3><table>
<thead>
<tr>
<th style="text-align:left">參數</th>
<th style="text-align:left">別名</th>
<th style="text-align:left">說明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">--sourcemap</td>
<td style="text-align:left">-sm</td>
<td style="text-align:left">建立 source map</td>
</tr>
<tr>
<td style="text-align:left">--aot</td>
<td style="text-align:left"></td>
<td style="text-align:left">Ahead of Time compilation</td>
</tr>
<tr>
<td style="text-align:left">--watch</td>
<td style="text-align:left">-w</td>
<td style="text-align:left">監控程式碼變成，並重新 build</td>
</tr>
</tbody>
</table>
<h4 id="輸出-Build-Bundles-說明"><a href="#輸出-Build-Bundles-說明" class="headerlink" title="輸出 Build Bundles 說明"></a>輸出 Build Bundles 說明</h4><p>專案 build 之後，會將專案用到的 js bundle  起來，每一個 bundle js 都有自己的職責。</p>
<table>
<thead>
<tr>
<th style="text-align:left">js 檔案</th>
<th style="text-align:left">說明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">inline.bundle.js</td>
<td style="text-align:left">WebPack runtime，應用程式拿來用來讀取 module 用</td>
</tr>
<tr>
<td style="text-align:left">main.bundle.js</td>
<td style="text-align:left">我們寫的程式碼</td>
</tr>
<tr>
<td style="text-align:left">polyfills.bundle.js</td>
<td style="text-align:left">用來支援不同的瀏覽器</td>
</tr>
<tr>
<td style="text-align:left">styles.bundle.js</td>
<td style="text-align:left">紀錄 styles 被放在哪裡</td>
</tr>
<tr>
<td style="text-align:left">vendor.bundle.js</td>
<td style="text-align:left">包含 Angular 和其他 third-party 檔案</td>
</tr>
</tbody>
</table>
<h2 id="啟動-webpack-dev-server"><a href="#啟動-webpack-dev-server" class="headerlink" title="啟動 webpack-dev-server"></a>啟動 webpack-dev-server</h2><div class="alert info no-icon"><p>ng serve</p>
</div>
<h3 id="設定參數說明"><a href="#設定參數說明" class="headerlink" title="設定參數說明:"></a>設定參數說明:</h3><table>
<thead>
<tr>
<th style="text-align:left">參數</th>
<th style="text-align:left">別名</th>
<th style="text-align:left">說明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">--open</td>
<td style="text-align:left">-o</td>
<td style="text-align:left">ng serve 後，開啟網頁</td>
</tr>
<tr>
<td style="text-align:left">--port</td>
<td style="text-align:left">-p</td>
<td style="text-align:left">指定 port 號</td>
</tr>
<tr>
<td style="text-align:left">--live-reload</td>
<td style="text-align:left">-lr</td>
<td style="text-align:left">檔案發生變更後，是否直接重新整理瀏覽器 <em>(-lr true or false)</em></td>
</tr>
<tr>
<td style="text-align:left">--ssl</td>
<td style="text-align:left"></td>
<td style="text-align:left">使用 https</td>
</tr>
<tr>
<td style="text-align:left">--proxy-config</td>
<td style="text-align:left">-pc</td>
<td style="text-align:left">Proxy configuration file</td>
</tr>
<tr>
<td style="text-align:left">--prod</td>
<td style="text-align:left"></td>
<td style="text-align:left">啟動時 server，使用 --prod 的設定</td>
</tr>
</tbody>
</table>
<h2 id="停掉-Angular-CLI-，-使用-webpack-控制專案"><a href="#停掉-Angular-CLI-，-使用-webpack-控制專案" class="headerlink" title="停掉 Angular CLI ， 使用 webpack 控制專案"></a>停掉 Angular CLI ， 使用 webpack 控制專案</h2><p>這個功能可讓懂前端開發工具的人，能夠有更多靈活的應用。<br><div class="alert info no-icon"><p>ng eject</p>
</div><br>執行指令後 Angular CLI 的功能都將會無法使用，例如 <code>ng build</code>, <code>ng serve</code> 等等…。</p>
<p><code>webpack.config.js</code>會被加入專案中，必且可以比較 <code>package.json</code> 改變的內容，會看到所有控制都交由原生的前端工具來執行。</p>
<div class="figure " style="width:;"><a class="fancybox" href="package.jpg" title="package" data-fancybox-group=""><img class="fig-img" src="package.jpg" alt="package"></a><span class="caption">package</span></div>]]></content>
    
    <summary type="html">
    
      &lt;ul&gt;
&lt;li&gt;建置專案與環境參數設定&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="Angular" scheme="https://mileslin.github.io/categories/Angular/"/>
    
    
      <category term="Angular CLI" scheme="https://mileslin.github.io/tags/Angular-CLI/"/>
    
      <category term="Angular" scheme="https://mileslin.github.io/tags/Angular/"/>
    
  </entry>
  
  <entry>
    <title>Angular CLI 實用小技巧 2</title>
    <link href="https://mileslin.github.io/2017/07/Angular-CLI-%E5%AF%A6%E7%94%A8%E5%B0%8F%E6%8A%80%E5%B7%A7-2/"/>
    <id>https://mileslin.github.io/2017/07/Angular-CLI-實用小技巧-2/</id>
    <published>2017-07-04T15:26:07.000Z</published>
    <updated>2017-07-09T08:15:30.192Z</updated>
    
    <content type="html"><![CDATA[<ul>
<li>建立元件與檔案 <em>(service,class,interface ….)</em></li>
<li>建立檔案時指令的預設值設定</li>
</ul>
<a id="more"></a>
<h2 id="建立-Component-小技巧"><a href="#建立-Component-小技巧" class="headerlink" title="建立 Component 小技巧"></a>建立 Component 小技巧</h2><div class="alert info no-icon"><p>ng g c &lt; options &gt;</p>
</div>
<table>
<thead>
<tr>
<th style="text-align:left">Options</th>
<th style="text-align:left">Alias</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">--flat</td>
<td style="text-align:left"></td>
<td style="text-align:left">不要建立 Component 資料夾</td>
</tr>
<tr>
<td style="text-align:left">--inline-template</td>
<td style="text-align:left">-it</td>
<td style="text-align:left">不會建立 .html，將 html template 寫在 .ts file</td>
</tr>
<tr>
<td style="text-align:left">--inline-style</td>
<td style="text-align:left">-is</td>
<td style="text-align:left">不會建立 .css，將 style 寫在 .ts file</td>
</tr>
<tr>
<td style="text-align:left">--spec false</td>
<td style="text-align:left"></td>
<td style="text-align:left">不會建立 .spec</td>
</tr>
<tr>
<td style="text-align:left">--prefix my</td>
<td style="text-align:left"></td>
<td style="text-align:left">selector 加上 my prefix. ex: my-pet instead of app-pet</td>
</tr>
<tr>
<td style="text-align:left">--dry-run</td>
<td style="text-align:left">-d</td>
<td style="text-align:left">顯示那些檔案會新增跟那些檔案會變更</td>
</tr>
</tbody>
</table>
<h2 id="建立-Service-小技巧"><a href="#建立-Service-小技巧" class="headerlink" title="建立 Service 小技巧"></a>建立 Service 小技巧</h2><p><em>此功能也能用在建立 Component 上</em><br><div class="alert info no-icon"><p>新增 service 並自動加入指定 module providers<br>ng g s my-service -m app.module</p>
</div></p>
<h2 id="建立-Classes-Interfaces-Enums-小技巧"><a href="#建立-Classes-Interfaces-Enums-小技巧" class="headerlink" title="建立 Classes, Interfaces, Enums 小技巧"></a>建立 Classes, Interfaces, Enums 小技巧</h2><div class="alert info no-icon"><p>在 models 底下建立 class<br>ng g cl models/customer</p>
</div>
<div class="alert info no-icon"><p>在 models 底下建立 interface<br>ng g i models/person</p>
</div>
<div class="alert info no-icon"><p>在 models 底下建立 enum<br>ng g e models/gender</p>
</div>
<h2 id="建立預設值-超好用"><a href="#建立預設值-超好用" class="headerlink" title="建立預設值(超好用)"></a>建立<options>預設值(超好用)</options></h2><p>此設定會寫在 .angular-cli.json 底下 defautls 區塊<br><div class="figure " style="width:;"><a class="fancybox" href="defaults.jpg" title="" data-fancybox-group=""><img class="fig-img" src="defaults.jpg" alt=""></a></div></p>
<div class="alert success no-icon"><p>建立 component 時候，自動不產生 .spec<br>ng set defaults.component.spec false</p>
</div>
]]></content>
    
    <summary type="html">
    
      &lt;ul&gt;
&lt;li&gt;建立元件與檔案 &lt;em&gt;(service,class,interface ….)&lt;/em&gt;&lt;/li&gt;
&lt;li&gt;建立檔案時指令的預設值設定&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="Angular" scheme="https://mileslin.github.io/categories/Angular/"/>
    
    
      <category term="Angular CLI" scheme="https://mileslin.github.io/tags/Angular-CLI/"/>
    
      <category term="Angular" scheme="https://mileslin.github.io/tags/Angular/"/>
    
  </entry>
  
  <entry>
    <title>Angular CLI 實用小技巧 1</title>
    <link href="https://mileslin.github.io/2017/07/Angular-CLI-%E5%AF%A6%E7%94%A8%E5%B0%8F%E6%8A%80%E5%B7%A7-1/"/>
    <id>https://mileslin.github.io/2017/07/Angular-CLI-實用小技巧-1/</id>
    <published>2017-07-02T14:47:41.000Z</published>
    <updated>2017-07-09T08:15:34.565Z</updated>
    
    <content type="html"><![CDATA[<ul>
<li>建立專案與元件</li>
<li>程式碼一致性 <em>(lint)</em></li>
</ul>
<a id="more"></a>
<h2 id="建立專案與元件類型"><a href="#建立專案與元件類型" class="headerlink" title="建立專案與元件類型"></a>建立專案與元件類型</h2><p><code>--skip-install</code> 建立NG專案的時候，不會執行 <code>npm install</code>。<br><div class="alert info no-icon"><p>ng new ngtest –skip-install</p>
</div></p>
<p><code>--help</code> 顯示建立專案時，有哪些參數可以設定。<br><div class="alert info no-icon"><p>ng new –help</p>
</div></p>
<p><code>--routing</code> 建立專案時，建立 app-routing.module.ts ， 並且 app.module.ts 自動 import AppRoutingModule。   <em>此功能也能用在建立 module 。</em><br><div class="alert info no-icon"><p>ng new ngtest –routing<br>ng g m sales –routing</p>
</div></p>
<p><code>--style scss</code> 使用 sass 寫 css 。<br><div class="alert info no-icon"><p>ng new ngtest –style scss</p>
</div></p>
<p><code>--dry-run</code> 不會建立檔案與修改檔案，但會顯示建立哪些檔案，修改哪些檔案。<br><div class="alert info no-icon"><p>ng g c –dry-run</p>
</div></p>
<p><code>--spec false</code> 建立 component 的時候不要建立 *.spec 測試檔。<br><div class="alert info no-icon"><p>ng g c my-component  –spec false</p>
</div></p>
<h2 id="其他類型"><a href="#其他類型" class="headerlink" title="其他類型"></a>其他類型</h2><p>啟動 Angular 專案，並且開啟瀏覽器。<br><div class="alert info no-icon"><p>ng serve -o</p>
</div></p>
<p>檢查 typescript 程式碼的一致性。 加上參數 <code>--help</code> 會顯示有哪些設定參數可用。<br><div class="alert info no-icon"><p>ng lint </p>
</div></p>
<p><code>--format stylish</code> cmd 顯示的輸出結果經過格式化，閱讀性更佳。<br><div class="alert info no-icon"><p>ng lint –format stylish</p>
</div></p>
<p><code>--fix</code> 嘗試自動修正程式碼。<br><div class="alert info no-icon"><p>ng lint –fix</p>
</div></p>
<h3 id="參考"><a href="#參考" class="headerlink" title="參考"></a>參考</h3><a href="https://app.pluralsight.com/library/courses/angular-cli/table-of-contents" title="PluralSight Angular CLI Course" target="_blank" rel="external">PluralSight Angular CLI Course</a>
<a href="https://github.com/angular/angular-cli" title="Angular-CLI" target="_blank" rel="external">Angular-CLI</a>
]]></content>
    
    <summary type="html">
    
      &lt;ul&gt;
&lt;li&gt;建立專案與元件&lt;/li&gt;
&lt;li&gt;程式碼一致性 &lt;em&gt;(lint)&lt;/em&gt;&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="Angular" scheme="https://mileslin.github.io/categories/Angular/"/>
    
    
      <category term="Angular CLI" scheme="https://mileslin.github.io/tags/Angular-CLI/"/>
    
      <category term="Angular" scheme="https://mileslin.github.io/tags/Angular/"/>
    
  </entry>
  
  <entry>
    <title>DI 地雷之生命週期很重要</title>
    <link href="https://mileslin.github.io/2017/06/DI-%E5%9C%B0%E9%9B%B7%E4%B9%8B%E7%94%9F%E5%91%BD%E9%80%B1%E6%9C%9F%E5%BE%88%E9%87%8D%E8%A6%81/"/>
    <id>https://mileslin.github.io/2017/06/DI-地雷之生命週期很重要/</id>
    <published>2017-06-30T10:50:44.000Z</published>
    <updated>2017-07-05T03:09:49.189Z</updated>
    
    <content type="html"><![CDATA[<p>目前為止設定 DI 都是按照官方的文件設定一下，就放著不理他了。  結果今天踩到一個超級大雷，所以我要鄭重地說:</p>
<div class="alert warning"><p>DI 的三種生命週期很重要!!  不要亂設定!!</p>
</div>
<a id="more"></a>
<h2 id="前提概要"><a href="#前提概要" class="headerlink" title="前提概要"></a>前提概要</h2><p>因為我最近都在整合 PayPal 的服務，所以很常要寫程式發 <code>http request</code>，而我用的則是 <a href="http://restsharp.org/" title="RestSharp" target="_blank" rel="external">RestSharp</a> 這個套件，他是一個只要設定網址、header、body等等…就能夠很輕易地發送 <code>http request</code>。</p>
<p>根據 PayPal API 的規範，在使用付款或者建立發票等等的 API ，要先去呼叫 OAuth API 取的 token。</p>
<p>所以我程式就這樣設計</p>
<ul>
<li>使用 <a href="http://restsharp.org/" title="RestSharp" target="_blank" rel="external">RestSharp</a> 套件的 RestClient 發送 <code>http request</code></li>
<li>PayPalService 使用 <span class="highlight-text success">RestClient
 </span> 呼叫 OAuth API 取得 token。</li>
<li>InvoiceService 使用 <span class="highlight-text success">RestClient
 </span> 呼叫發票相關 API 建立發票，而在呼叫建立發票 request 的時後，要傳入 token。</li>
</ul>
<h2 id="程式範例"><a href="#程式範例" class="headerlink" title="程式範例"></a>程式範例</h2><p>為了讓程式能夠更容易了解，我有將原本的程式碼簡化，而這三個類別程式碼如下</p>
<!-- classes : info success warning danger no-icon -->
<div class="alert info no-icon"><p>PayPalService 與 InvoiceService 都是呼叫 restClient.Url 設定網址，接下來就是發送 request</p>
</div>
<figure class="codeblock codeblock--tabbed"><figcaption><span>code</span><ul class="tabs"><li class="tab active">RestClient</li><li class="tab">PayPalService</li><li class="tab">InvoiceService</li></ul></figcaption><div class="tabs-content"><figure class="highlight plain" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public class RestClient : IRestClient</span><br><span class="line">{</span><br><span class="line">    public string Url { get; set; }</span><br><span class="line"></span><br><span class="line">    public string SendRequest(RestRequest request)</span><br><span class="line">    {</span><br><span class="line">        return $"I use this url:{Url} send request";</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plain" style="display: none;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">public class PayPalService : IPayPalService</span><br><span class="line">{</span><br><span class="line">    private IRestClient _restClient;</span><br><span class="line"></span><br><span class="line">    public PayPalService(IRestClient restClient)</span><br><span class="line">    {</span><br><span class="line">        this._restClient = restClient;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public string GetToken()</span><br><span class="line">    {</span><br><span class="line">        string url = @"https://api.PayPal/GetToken/xxx";</span><br><span class="line">        _restClient.Url = url;</span><br><span class="line"></span><br><span class="line">        var request = new RestRequest(Method.POST);            </span><br><span class="line">        string result = _restClient.SendRequest(request);</span><br><span class="line"></span><br><span class="line">        return result;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plain" style="display: none;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">public class InvoiceService : IInvoiceService</span><br><span class="line">{</span><br><span class="line">    private IRestClient _restClient;</span><br><span class="line">    private IPayPalService _payPalService;</span><br><span class="line">    public InvoiceService(</span><br><span class="line">        IRestClient restClient,</span><br><span class="line">        IPayPalService payPalService)</span><br><span class="line">    {</span><br><span class="line">        this._restClient = restClient;</span><br><span class="line">        this._payPalService = payPalService;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public void CreateInvoice()</span><br><span class="line">    {</span><br><span class="line">        string url = @"https://api.PayPal/xxx/invoice";</span><br><span class="line">        _restClient.Url = url;</span><br><span class="line"></span><br><span class="line">        string token = this._payPalService.GetToken();</span><br><span class="line"></span><br><span class="line">        var request = new RestRequest(Method.POST);            </span><br><span class="line">        request.AddHeader("authorization", $"{token}");                        </span><br><span class="line">        string result = _restClient.SendRequest(request);</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div></figure>
<p>接下來我有一個 <code>ValuesController</code> 建構式注入 <code>IInvoiceService</code>， 並且有一個建立發票的API。</p>
<figure class="codeblock codeblock--tabbed"><figcaption><span>ValuesController</span><ul class="tabs"><li class="tab active">cs</li></ul></figcaption><div class="tabs-content"><figure class="highlight cs" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ValuesController</span> : <span class="title">ApiController</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">private</span> IInvoiceService _invoiceService;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ValuesController</span>(<span class="params">IInvoiceService invoiceService</span>)</span><br><span class="line">    </span>{</span><br><span class="line">        <span class="keyword">this</span>._invoiceService = invoiceService;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    [HttpGet]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> IHttpActionResult <span class="title">CreateInvoice</span>(<span class="params"></span>)</span><br><span class="line">    </span>{</span><br><span class="line">        <span class="keyword">this</span>._invoiceService.CreateInvoice();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Ok();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div></figure>
<h4 id="程式碼跑執行之網址改變了"><a href="#程式碼跑執行之網址改變了" class="headerlink" title="程式碼跑執行之網址改變了"></a>程式碼跑執行之網址改變了</h4><div class="figure " style="width:;"><a class="fancybox" href="UrlChange.gif" title="Url 改變了 !!" data-fancybox-group=""><img class="fig-img" src="UrlChange.gif" alt="Url 改變了 !!"></a><span class="caption">Url 改變了 !!</span></div><div style="clear:both;"></div>
<h3 id="為什麼會這樣"><a href="#為什麼會這樣" class="headerlink" title="為什麼會這樣"></a>為什麼會這樣</h3><p>因為我 DI 注入的時候使用 <code>InstancePerLifetimeScope</code> 的生命週期</p>
<div class="figure " style="width:;"><a class="fancybox" href="Inject.jpg" title="" data-fancybox-group=""><img class="fig-img" src="Inject.jpg" alt=""></a></div>
<div class="alert danger no-icon"><p>意思是說，只要是同一個 request 就會使用同一個物件 !!!</p>
<p>PayPalService 與 InvoiceService 使用的是同一個 RestClient 物件</p>
<p>所以在取得 Token 的時候，把 InvoiceService 設定好的 Url 覆寫掉了</p>
</div>
<h3 id="DI-三種生命週期"><a href="#DI-三種生命週期" class="headerlink" title="DI 三種生命週期"></a>DI 三種生命週期</h3><ul>
<li>SingleInstance           : 整個應用程式都是使用同一個物件</li>
<li>InstancePerLifetimeScope : 只要是同一個 request 則使用同一個物件</li>
<li>InstancePerDependency    : 只要有注入都是一個全新的物件</li>
</ul>
<p>所以我只要將 RestClient 注入的生命週期改成 <code>InstancePerDependency</code>，問題就會解決了。</p>
<div class="figure " style="width:;"><a class="fancybox" href="InstancePerDependency.jpg" title="" data-fancybox-group=""><img class="fig-img" src="InstancePerDependency.jpg" alt=""></a></div>
<p>執行結果<br><div class="figure " style="width:;"><a class="fancybox" href="UrlNoChange.gif" title="Url 沒有改變 !!" data-fancybox-group=""><img class="fig-img" src="UrlNoChange.gif" alt="Url 沒有改變 !!"></a><span class="caption">Url 沒有改變 !!</span></div><div style="clear:both;"></div></p>
<h3 id="參考"><a href="#參考" class="headerlink" title="參考"></a>參考</h3><a href="http://docs.autofac.org/en/latest/lifetime/instance-scope.html#" title="Autofac" target="_blank" rel="external">docs.autofac.org</a>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;目前為止設定 DI 都是按照官方的文件設定一下，就放著不理他了。  結果今天踩到一個超級大雷，所以我要鄭重地說:&lt;/p&gt;
&lt;div class=&quot;alert warning&quot;&gt;&lt;p&gt;DI 的三種生命週期很重要!!  不要亂設定!!&lt;/p&gt;
&lt;/div&gt;
    
    </summary>
    
      <category term="Autofac" scheme="https://mileslin.github.io/categories/Autofac/"/>
    
    
      <category term=".NET" scheme="https://mileslin.github.io/tags/NET/"/>
    
      <category term="C#" scheme="https://mileslin.github.io/tags/C/"/>
    
      <category term="Autofac" scheme="https://mileslin.github.io/tags/Autofac/"/>
    
  </entry>
  
  <entry>
    <title>單元測試 Model 驗證</title>
    <link href="https://mileslin.github.io/2017/06/%E5%96%AE%E5%85%83%E6%B8%AC%E8%A9%A6Model%E9%A9%97%E8%AD%89/"/>
    <id>https://mileslin.github.io/2017/06/單元測試Model驗證/</id>
    <published>2017-06-30T04:17:39.000Z</published>
    <updated>2017-07-05T03:09:49.227Z</updated>
    
    <content type="html"><![CDATA[<p>MVC 在寫商業邏輯驗證的時候，通常都會寫在Model裡面，這好處除了統一的寫法之外，單元測試也很好寫，今天就來說明如何單元測試 Model 驗證。</p>
<a id="more"></a>
<p>首先我們會有一個要被驗證的 Model<br><figure class="codeblock codeblock--tabbed"><figcaption><span>Model</span><ul class="tabs"><li class="tab active">cs</li></ul></figcaption><div class="tabs-content"><figure class="highlight cs" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">VM</span> : <span class="title">IValidatableObject</span></span><br><span class="line">{        </span><br><span class="line">    [Required]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">string</span> Email { <span class="keyword">get</span>; <span class="keyword">set</span>; }</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">string</span> Name { <span class="keyword">get</span>; <span class="keyword">set</span>; }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IEnumerable&lt;ValidationResult&gt; <span class="title">Validate</span>(<span class="params">ValidationContext validationContext</span>)</span><br><span class="line">    </span>{            </span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.Name == <span class="string">"Test"</span>)            </span><br><span class="line">        {</span><br><span class="line">            <span class="function"><span class="keyword">yield</span> return new <span class="title">ValidationResult</span>(<span class="params"><span class="string">"Please, set right name"</span></span>)</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div></figure></p>
<h2 id="使用-Validator-驗證-Model"><a href="#使用-Validator-驗證-Model" class="headerlink" title="使用 Validator 驗證 Model"></a>使用 Validator 驗證 Model</h2><p>寫單元測試的話，其實很簡單，只要用 <code>Validator.TryValidateObject</code> 就能夠知道是否驗證成功，以及取得錯誤訊息。<br>所以寫單元測試就兩個重點要記得，這樣就能輕易寫 Model 驗證的單元測試了:</p>
<ul>
<li><code>Validator.TryValidateObject</code> 回傳是否驗證成功</li>
<li>傳入 <code>List&lt;ValidationResult&gt;</code> 取得錯誤訊息</li>
</ul>
<figure class="codeblock codeblock--tabbed"><figcaption><span>Unit Test</span><ul class="tabs"><li class="tab active">cs</li></ul></figcaption><div class="tabs-content"><figure class="highlight cs" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[TestMethod()]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ValidateTest</span>(<span class="params"></span>)</span><br><span class="line"></span>{</span><br><span class="line">    <span class="comment">// Arrange</span></span><br><span class="line">    <span class="keyword">var</span> model = <span class="keyword">new</span> VM()</span><br><span class="line">    {</span><br><span class="line">        Email = <span class="literal">null</span></span><br><span class="line">    };</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Act</span></span><br><span class="line">    <span class="keyword">var</span> validationResults = <span class="keyword">new</span> List&lt;ValidationResult&gt;();</span><br><span class="line">    <span class="keyword">var</span> actual = Validator.TryValidateObject(model, <span class="keyword">new</span> ValidationContext(model), validationResults, validateAllProperties: <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Assert</span></span><br><span class="line">    Assert.IsFalse(actual, <span class="string">"Expected validation to fail."</span>);</span><br><span class="line">    Assert.IsTrue(validationResults[<span class="number">0</span>].MemberNames.ElementAt(<span class="number">0</span>) == <span class="keyword">nameof</span>(model.Email));</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div></figure>
<h3 id="參考"><a href="#參考" class="headerlink" title="參考"></a>參考</h3><a href="https://www.intertech.com/Blog/unit-test-net-entity-validation/" title="How to Unit Test .NET Entity Validation" target="_blank" rel="external">How to Unit Test .NET Entity Validation</a>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;MVC 在寫商業邏輯驗證的時候，通常都會寫在Model裡面，這好處除了統一的寫法之外，單元測試也很好寫，今天就來說明如何單元測試 Model 驗證。&lt;/p&gt;
    
    </summary>
    
      <category term="Unit Test" scheme="https://mileslin.github.io/categories/Unit-Test/"/>
    
    
      <category term="MVC" scheme="https://mileslin.github.io/tags/MVC/"/>
    
      <category term="Unit Test" scheme="https://mileslin.github.io/tags/Unit-Test/"/>
    
  </entry>
  
  <entry>
    <title>Destructuring assignment</title>
    <link href="https://mileslin.github.io/2017/06/Destructuring-assignment/"/>
    <id>https://mileslin.github.io/2017/06/Destructuring-assignment/</id>
    <published>2017-06-28T15:52:51.000Z</published>
    <updated>2017-07-05T03:09:49.225Z</updated>
    
    <content type="html"><![CDATA[<p>解構賦值是一種優雅的方式能夠將<code>{}</code>與<code>[]</code>的值讀出來<br><a id="more"></a></p>
<h2 id="讀取陣列並-assign-到變數上"><a href="#讀取陣列並-assign-到變數上" class="headerlink" title="讀取陣列並 assign 到變數上"></a>讀取陣列並 assign 到變數上</h2><p><em>陣列的解構賦值用陣列去接</em><br><figure class="codeblock codeblock--tabbed"><figcaption><span>JavaScript</span><ul class="tabs"><li class="tab active">js</li></ul></figcaption><div class="tabs-content"><figure class="highlight js" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> foo = [<span class="string">'one'</span>, <span class="string">'two'</span>, <span class="string">'three'</span>];</span><br><span class="line"><span class="keyword">let</span> [one, two, three] = foo;</span><br><span class="line"><span class="built_in">console</span>.log(one); <span class="comment">// 'one'</span></span><br></pre></td></tr></tbody></table></figure></div></figure></p>
<h2 id="物件的解構賦值"><a href="#物件的解構賦值" class="headerlink" title="物件的解構賦值"></a>物件的解構賦值</h2><p>在ES6有支援物件的解構賦值，這就能用在更多的用途上。  例如這有點像 import module 的用法。<br><em>物件的解構賦值用物件去接</em><br><figure class="codeblock codeblock--tabbed"><figcaption><span>js</span><ul class="tabs"><li class="tab active">js</li></ul></figcaption><div class="tabs-content"><figure class="highlight js" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> myModule = {</span><br><span class="line">  <span class="attr">drawSquare</span>: <span class="function"><span class="keyword">function</span> <span class="title">drawSquare</span>(<span class="params">length</span>) </span>{ <span class="comment">/* implementation */</span> },</span><br><span class="line">  <span class="attr">drawCircle</span>: <span class="function"><span class="keyword">function</span> <span class="title">drawCircle</span>(<span class="params">radius</span>) </span>{ <span class="comment">/* implementation */</span> },</span><br><span class="line">  <span class="attr">drawText</span>: <span class="function"><span class="keyword">function</span> <span class="title">drawText</span>(<span class="params">text</span>) </span>{ <span class="comment">/* implementation */</span> },</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> {drawSquare, drawText} = myModule;</span><br><span class="line"></span><br><span class="line">drawSquare(<span class="number">5</span>);</span><br><span class="line">drawText(<span class="string">'hello'</span>);</span><br></pre></td></tr></tbody></table></figure></div></figure></p>
<h2 id="傳入-function-的解構賦值"><a href="#傳入-function-的解構賦值" class="headerlink" title="傳入 function 的解構賦值"></a>傳入 function 的解構賦值</h2><p>解構賦值也允許你傳入 function ，並且 function’s parameter 指定要讀取哪一個 properties。<br><!-- classes : info success warning danger no-icon --><br><div class="alert info no-icon"><p>function 參數的 property 名稱要與傳入物件的 property 名稱一致，否額會 undefined</p>
</div><br><figure class="codeblock codeblock--tabbed"><figcaption><span>js</span><ul class="tabs"><li class="tab active">js</li></ul></figcaption><div class="tabs-content"><figure class="highlight js" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> jane = { <span class="attr">firstName</span>: <span class="string">'Jane'</span>, <span class="attr">lastName</span>: <span class="string">'Doe'</span>};</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sayName</span>(<span class="params">{firstName, lastName, middleName = <span class="string">'N/A'</span>}</span>) </span>{</span><br><span class="line">  <span class="built_in">console</span>.log(firstName);  <span class="comment">// Jane</span></span><br><span class="line">  <span class="built_in">console</span>.log(lastName);   <span class="comment">// Doe</span></span><br><span class="line">  <span class="built_in">console</span>.log(middleName); <span class="comment">// N/A</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">sayName(jane)</span><br></pre></td></tr></tbody></table></figure></div></figure></p>
<h2 id="陣列變數交換的用法"><a href="#陣列變數交換的用法" class="headerlink" title="陣列變數交換的用法"></a>陣列變數交換的用法</h2><p>陣列可以用解構賦值的方式，交換陣列的值<br><figure class="codeblock codeblock--tabbed"><figcaption><span>js</span><ul class="tabs"><li class="tab active">js</li></ul></figcaption><div class="tabs-content"><figure class="highlight js" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">let</span> b = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">[a, b] = [b, a];</span><br><span class="line"><span class="built_in">console</span>.log(a); <span class="comment">// 3</span></span><br><span class="line"><span class="built_in">console</span>.log(b); <span class="comment">// 1</span></span><br></pre></td></tr></tbody></table></figure></div></figure></p>
<h3 id="參考"><a href="#參考" class="headerlink" title="參考"></a>參考</h3><a href="https://angular-2-training-book.rangle.io/handout/features/destructuring.html" title="angular-2-training-book" target="_blank" rel="external">angular-2-training-book</a> <a href="https://developer.mozilla.org/zh-TW/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment" title="MDN" target="_blank" rel="external">MDN</a>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;解構賦值是一種優雅的方式能夠將&lt;code&gt;{}&lt;/code&gt;與&lt;code&gt;[]&lt;/code&gt;的值讀出來&lt;br&gt;
    
    </summary>
    
      <category term="javascript" scheme="https://mileslin.github.io/categories/javascript/"/>
    
    
      <category term="javascript" scheme="https://mileslin.github.io/tags/javascript/"/>
    
  </entry>
  
  <entry>
    <title>擴充套件屬性，以sweetalert為例</title>
    <link href="https://mileslin.github.io/2017/06/%E6%93%B4%E5%85%85%E5%A5%97%E4%BB%B6%E5%B1%AC%E6%80%A7%EF%BC%8C%E4%BB%A5sweetalert%E7%82%BA%E4%BE%8B/"/>
    <id>https://mileslin.github.io/2017/06/擴充套件屬性，以sweetalert為例/</id>
    <published>2017-06-23T06:25:13.000Z</published>
    <updated>2017-07-05T03:09:49.228Z</updated>
    
    <content type="html"><![CDATA[<p>最近專案上有使用到 <a href="https://limonte.github.io/sweetalert2/" title="Sweetalter2" target="_blank" rel="external">Sweetalter2</a> ，可是目前 typescript 的 typing 檔案，只有 Sweetalter 的版本，導致有很多屬性在使用的時候，typescript 看不懂，例如 <span class="highlight-text danger">input </span>  這個屬性。</p>
<figure class="codeblock codeblock--tabbed"><figcaption><span>error_input</span><ul class="tabs"><li class="tab active">ts</li></ul></figcaption><div class="tabs-content"><figure class="highlight ts" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">swal({</span><br><span class="line">  title: <span class="string">'Oops !!!'</span>,</span><br><span class="line">  input: <span class="string">'email'</span> <span class="comment">// &lt;- error</span></span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure></div></figure>
<a id="more"></a>
<p>要解決這個問題呢，我們首先要先知道 <code>swal({})</code> 是傳入什麼型別，這時候就要找 sweetalert typing 定義檔，就可以看到 <code>swal({})</code> 傳入的型別是什麼。<br><div class="figure " style="width:;"><a class="fancybox" href="sweetalter_typing.jpg" title="sweetalter_typing" data-fancybox-group=""><img class="fig-img" src="sweetalter_typing.jpg" alt="sweetalter_typing"></a><span class="caption">sweetalter_typing</span></div></p>
<div class="alert info"><p>declare namespace SweetAlert 底下的 interface SettingsBase</p>
</div>
<p>型別定義在 namespace SweetAlert 底下的 interface ，知道定義型別的地方後，接下就當然不能直接在這邊新增，因為這是 npm 下載下來的 package。  我們要直接去 typescript 的 typing 新增 SettingsBase 的擴充。</p>
<p>在 Angular 專案底下的 <code>src\typings.d.ts</code>，新增同樣 namespace 與 interface<br><div class="figure " style="width:;"><a class="fancybox" href="extend_typing.jpg" title="extend_typing" data-fancybox-group=""><img class="fig-img" src="extend_typing.jpg" alt="extend_typing"></a><span class="caption">extend_typing</span></div></p>
<p>就可以發現，我們使用 <code>swal({})</code> 就可以傳入 input 屬性了。<br><div class="figure " style="width:;"><a class="fancybox" href="success.jpg" title="success" data-fancybox-group=""><img class="fig-img" src="success.jpg" alt="success"></a><span class="caption">success</span></div></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;最近專案上有使用到 &lt;a href=&quot;https://limonte.github.io/sweetalert2/&quot; title=&quot;Sweetalter2&quot;&gt;Sweetalter2&lt;/a&gt; ，可是目前 typescript 的 typing 檔案，只有 Sweetalter 的版本，導致有很多屬性在使用的時候，typescript 看不懂，例如 &lt;span class=&quot;highlight-text danger&quot;&gt;input &lt;/span&gt;  這個屬性。&lt;/p&gt;
&lt;figure class=&quot;codeblock codeblock--tabbed&quot;&gt;&lt;figcaption&gt;&lt;span&gt;error_input&lt;/span&gt;&lt;ul class=&quot;tabs&quot;&gt;&lt;li class=&quot;tab active&quot;&gt;ts&lt;/li&gt;&lt;/ul&gt;&lt;/figcaption&gt;&lt;div class=&quot;tabs-content&quot;&gt;&lt;figure class=&quot;highlight ts&quot; style=&quot;display: block;&quot;&gt;&lt;table&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;swal({&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  title: &lt;span class=&quot;string&quot;&gt;&#39;Oops !!!&#39;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  input: &lt;span class=&quot;string&quot;&gt;&#39;email&#39;&lt;/span&gt; &lt;span class=&quot;comment&quot;&gt;// &amp;lt;- error&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;});&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/div&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="Angular" scheme="https://mileslin.github.io/categories/Angular/"/>
    
    
      <category term="Angular" scheme="https://mileslin.github.io/tags/Angular/"/>
    
      <category term="typescript" scheme="https://mileslin.github.io/tags/typescript/"/>
    
  </entry>
  
  <entry>
    <title>為什麼需要 Domain-Driven Design</title>
    <link href="https://mileslin.github.io/2017/05/%E7%82%BA%E4%BB%80%E9%BA%BC%E9%9C%80%E8%A6%81-Domain-Driven-Design/"/>
    <id>https://mileslin.github.io/2017/05/為什麼需要-Domain-Driven-Design/</id>
    <published>2017-05-21T15:51:09.000Z</published>
    <updated>2017-05-21T17:01:39.882Z</updated>
    
    <content type="html"><![CDATA[<p>最近開始看 Donmain-Driven Design 的 <a href="https://app.pluralsight.com/library/courses/domain-driven-design-fundamentals/table-of-contents" title="TitleAttribute" target="_blank" rel="external">plurasight 的影片</a> ，其裡面有一句話深深吸引我，而當我開始看 DDD 的教學影片時，發現需要知道的內容，是多麼的廣泛，這句話當之無愧。。<br> <blockquote><p>The more you know, the more you realize you know nothing</p>
<footer><strong>Socrates</strong></footer></blockquote></p>
<a id="more"></a> 
<h2 id="為什麼需要-DDD"><a href="#為什麼需要-DDD" class="headerlink" title="為什麼需要 DDD?"></a>為什麼需要 DDD?</h2><p>DDD 開發專注在理解使用者的需求，專注在 <span class="highlight-text primary">Domain</span> 上，理解之後才開始寫程式碼。
t
DDD 有其準則跟模式，幫助我們解決困難複雜的問題。  能夠幫助我們寫出代表 <span class="highlight-text primary">Domain</span> 乾淨且可測試的程式碼，</p>
<p>DDD 幫助我們專注在更小、獨立 <span class="highlight-text primary">Domain</span>，讓我們在開發上更為準確。 </p>
<h2 id="需要一位-Domain-Experts"><a href="#需要一位-Domain-Experts" class="headerlink" title="需要一位 Domain Experts"></a>需要一位 Domain Experts</h2><p>在 DDD 開發上，是非常重視溝通，其需要一位懂專業領域的專家，幫助我們釐清問題，其 Domain Experts 可以是合作的客戶、可以是專案上的 PM 等等….</p>
<h2 id="用一張大圖來表示-DDD"><a href="#用一張大圖來表示-DDD" class="headerlink" title="用一張大圖來表示 DDD"></a>用一張大圖來表示 DDD</h2><p>Slides 的這張投影片，這就 DDD 需要懂的概念，因為剛開始在學習，目前懂的東西還不多，為了呼應開頭的引言，就先放在這邊嚇嚇大家XD</p>
<div class="figure " style="width:;"><a class="fancybox" href="DDD_Big_Picture.jpg" title="DDD_Big_Picture" data-fancybox-group=""><img class="fig-img" src="DDD_Big_Picture.jpg" alt="DDD_Big_Picture"></a><span class="caption">DDD_Big_Picture</span></div>
<h2 id="DDD-的優點"><a href="#DDD-的優點" class="headerlink" title="DDD 的優點"></a>DDD 的優點</h2><ul>
<li>延展性  </li>
<li>站在使用者的角度來看問題</li>
<li>有一套流程處理複雜的問題</li>
<li>幫助我們寫有組織且可測試的程式碼</li>
<li>所有的商業邏輯集中在一個地方</li>
<li>有很多 patterns 可以在專案中使用</li>
</ul>
<p>雖然 DDD 提供很優點，像是好維護，並有一套的溝通方式幫助我們理解複雜的商業邏輯，但是這應該是用在有複雜商業邏輯的專案上。</p>
 <blockquote><p>While Domain-Driven Design provides many technical benefits, such as maintainability, it should be applied only to complex domains where the model and the linguistic processes provide clear benefits in the communication of complex information, and in the formulation of a common understanding of the domain.</p>
<footer><strong>Eric Evans</strong><cite>Domain-Driven Design</cite></footer></blockquote>
<h2 id="DDD-的缺點"><a href="#DDD-的缺點" class="headerlink" title="DDD 的缺點"></a>DDD 的缺點</h2><ul>
<li>花時間<ul>
<li>溝通並理解商業邏輯，理解什麼問題該被解決</li>
<li>將商業邏從應用程式中獨立出來</li>
</ul>
</li>
<li>學習曲線<ul>
<li>不同的開發原則</li>
<li>新的 patterns</li>
<li>新的開發方式</li>
</ul>
</li>
<li>只用在擁有複雜商業邏輯的專案上<ul>
<li>不適合用無複雜商業邏輯的專案，只有在做 CRUD 的情境上</li>
<li>技術複雜但是商業邏輯簡單的情境，也不適用</li>
</ul>
</li>
<li>公司也需要同意執行 DDD 才可以!!!!</li>
</ul>
<h3 id="小結"><a href="#小結" class="headerlink" title="小結"></a>小結</h3><p>DDD 真的是一個很大的主題，在看影片上，常常同一個影片也要多看幾次，才稍微理解裡面講的內容。  也因為剛開始學習的關係，若提及的內容與讀者理解稍有不同，也歡迎留言告知。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;最近開始看 Donmain-Driven Design 的 &lt;a href=&quot;https://app.pluralsight.com/library/courses/domain-driven-design-fundamentals/table-of-contents&quot; title=&quot;TitleAttribute&quot;&gt;plurasight 的影片&lt;/a&gt; ，其裡面有一句話深深吸引我，而當我開始看 DDD 的教學影片時，發現需要知道的內容，是多麼的廣泛，這句話當之無愧。。&lt;br&gt; &lt;blockquote&gt;&lt;p&gt;The more you know, the more you realize you know nothing&lt;/p&gt;
&lt;footer&gt;&lt;strong&gt;Socrates&lt;/strong&gt;&lt;/footer&gt;&lt;/blockquote&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Domain-Driven Design" scheme="https://mileslin.github.io/categories/Domain-Driven-Design/"/>
    
    
      <category term="Domain-Driven Design" scheme="https://mileslin.github.io/tags/Domain-Driven-Design/"/>
    
  </entry>
  
  <entry>
    <title>vscode 設定自動觸發 suggestions</title>
    <link href="https://mileslin.github.io/2017/05/vscode-%E8%A8%AD%E5%AE%9A%E8%87%AA%E5%8B%95%E8%A7%B8%E7%99%BC-suggestions/"/>
    <id>https://mileslin.github.io/2017/05/vscode-設定自動觸發-suggestions/</id>
    <published>2017-05-09T11:07:21.000Z</published>
    <updated>2017-05-21T15:19:04.156Z</updated>
    
    <content type="html"><![CDATA[<p>某一版 vscode 更新後，寫 markdown 文件時不會自動跑出小視窗提醒能輸入的 snippet，需要點 <span class="highlight-text primary">ctrl + space</span>
才會出現視窗，可是中文輸入法的 <span class="highlight-text primary">ctrl + space</span> 有自己的預設行為啊 !! 。</p>
<a id="more"></a>
<p>於是乎，我上 github 上去詢問是否有解決的方案，感謝官方的大神們有回我，結論是只要設定 markdown 的 quickSuggestions 就好了。  <a href="https://github.com/Microsoft/vscode/issues/26108#issuecomment-299738939" title="github回應" target="_blank" rel="external">github回應</a></p>
<h2 id="解法"><a href="#解法" class="headerlink" title="解法"></a>解法</h2><p>首先開啟 Command Palette (<code>Ctrl+Shift+P</code>)，輸入 <code>Configure language specific settings</code> 後按enter， 然後選擇 <code>markdown</code>。</p>
<p>在設定檔加入這段就可以了</p>
<div class="alert info"><p>“[markdown]”: {<br>    “editor.quickSuggestions”: true<br>}</p>
</div>
<p>完整片段<br><div class="figure " style="width:;"><a class="fancybox" href="setting.jpg" title="" data-fancybox-group=""><img class="fig-img" src="setting.jpg" alt=""></a></div><div style="clear:both;"></div></p>
<p>詳細設定說明: <a href="https://code.visualstudio.com/updates/v1_9#_language-specific-settings" title="language-specific-settings" target="_blank" rel="external">language-specific-settings</a></p>
<p>能解決這問題，太令人感動了&gt;&lt;”</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;某一版 vscode 更新後，寫 markdown 文件時不會自動跑出小視窗提醒能輸入的 snippet，需要點 &lt;span class=&quot;highlight-text primary&quot;&gt;ctrl + space&lt;/span&gt;
才會出現視窗，可是中文輸入法的 &lt;span class=&quot;highlight-text primary&quot;&gt;ctrl + space&lt;/span&gt; 有自己的預設行為啊 !! 。&lt;/p&gt;
    
    </summary>
    
      <category term="vscode" scheme="https://mileslin.github.io/categories/vscode/"/>
    
    
      <category term="vscode" scheme="https://mileslin.github.io/tags/vscode/"/>
    
      <category term="trigger" scheme="https://mileslin.github.io/tags/trigger/"/>
    
      <category term="suggestion" scheme="https://mileslin.github.io/tags/suggestion/"/>
    
  </entry>
  
  <entry>
    <title>Two way data binding event 的寫法</title>
    <link href="https://mileslin.github.io/2017/05/Two-way-data-binding-event-%E7%9A%84%E5%AF%AB%E6%B3%95/"/>
    <id>https://mileslin.github.io/2017/05/Two-way-data-binding-event-的寫法/</id>
    <published>2017-05-06T08:26:25.000Z</published>
    <updated>2017-05-21T15:19:04.155Z</updated>
    
    <content type="html"><![CDATA[<p>之前學的 two way binding 的寫法如下</p>
<figure class="codeblock codeblock--tabbed"><figcaption><span>[(ngModel)]</span><ul class="tabs"><li class="tab active">html</li></ul></figcaption><div class="tabs-content"><figure class="highlight html" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"firstName"</span> [(<span class="attr">ngModel</span>)]=<span class="string">"firstName"</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div></figure>
<p>今天要說明的是，如何把<code>( )</code>與<code>[ ]</code>分開寫，這樣就可以在使用者輸入的時候加入一些邏輯進入</p>
<a id="more"></a>
<h2 id="將小括號-另外寫"><a href="#將小括號-另外寫" class="headerlink" title="將小括號( )另外寫"></a>將小括號<code>( )</code>另外寫</h2><figure class="codeblock codeblock--tabbed"><figcaption><span>[(ngModel)]</span><ul class="tabs"><li class="tab active">html</li></ul></figcaption><div class="tabs-content"><figure class="highlight html" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"firstName"</span> [<span class="attr">ngModel</span>]=<span class="string">"firstName"</span>(<span class="attr">ngModelChange</span>)= <span class="string">"firstName=$event"</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div></figure>
<p>那這樣寫有什麼好處呢?  就是當我們想要在使用者輸入的時候增加一些邏輯，我們就可以這樣寫。</p>
<p>例如:強制使用者第一個字輸入大寫，我們就可以改寫成這樣</p>
<figure class="codeblock codeblock--tabbed"><figcaption><span>ToUpperCase</span><ul class="tabs"><li class="tab active">html</li><li class="tab">ts</li></ul></figcaption><div class="tabs-content"><figure class="highlight html" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"firstName"</span> [<span class="attr">ngModel</span>]=<span class="string">"firstName"</span> (<span class="attr">ngModelChange</span>)= <span class="string">"firstLetterToUpperCase($event)"</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><figure class="highlight ts" style="display: none;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> AppComponent {</span><br><span class="line"></span><br><span class="line">  firstName = <span class="string">''</span>;</span><br><span class="line">  firstLetterToUpperCase(value: <span class="built_in">string</span>){</span><br><span class="line">    <span class="keyword">if</span> (value.length &gt;<span class="number">0</span>) {</span><br><span class="line">      <span class="keyword">this</span>.firstName = value.charAt(<span class="number">0</span>).toUpperCase() + value.slice(<span class="number">1</span>);</span><br><span class="line">    }<span class="keyword">else</span>{</span><br><span class="line">      <span class="keyword">this</span>.firstName = value;</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div></figure>
<p>我覺得這個小技巧還蠻不錯的，甚至可以拿來更改使用者的輸入內容，防止使用者打錯格式之類的</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;之前學的 two way binding 的寫法如下&lt;/p&gt;
&lt;figure class=&quot;codeblock codeblock--tabbed&quot;&gt;&lt;figcaption&gt;&lt;span&gt;[(ngModel)]&lt;/span&gt;&lt;ul class=&quot;tabs&quot;&gt;&lt;li class=&quot;tab active&quot;&gt;html&lt;/li&gt;&lt;/ul&gt;&lt;/figcaption&gt;&lt;div class=&quot;tabs-content&quot;&gt;&lt;figure class=&quot;highlight html&quot; style=&quot;display: block;&quot;&gt;&lt;table&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;input&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;type&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;text&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;firstName&quot;&lt;/span&gt; [(&lt;span class=&quot;attr&quot;&gt;ngModel&lt;/span&gt;)]=&lt;span class=&quot;string&quot;&gt;&quot;firstName&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;p&gt;今天要說明的是，如何把&lt;code&gt;( )&lt;/code&gt;與&lt;code&gt;[ ]&lt;/code&gt;分開寫，這樣就可以在使用者輸入的時候加入一些邏輯進入&lt;/p&gt;
    
    </summary>
    
      <category term="Angular" scheme="https://mileslin.github.io/categories/Angular/"/>
    
    
      <category term="Angular" scheme="https://mileslin.github.io/tags/Angular/"/>
    
      <category term="binding" scheme="https://mileslin.github.io/tags/binding/"/>
    
  </entry>
  
  <entry>
    <title>User input 實用的 key 事件</title>
    <link href="https://mileslin.github.io/2017/05/User-input-%E5%AF%A6%E7%94%A8%E7%9A%84-key-%E4%BA%8B%E4%BB%B6/"/>
    <id>https://mileslin.github.io/2017/05/User-input-實用的-key-事件/</id>
    <published>2017-05-02T16:30:27.000Z</published>
    <updated>2017-05-21T15:19:04.156Z</updated>
    
    <content type="html"><![CDATA[<p>使用者輸入資料的時候，通常會綁定一些事情，做一些邏輯之類的，例如:使用者點選 Enter 則執行搜尋功能等等….</p>
<a id="more"></a>
<h2 id="keyup-事件"><a href="#keyup-事件" class="headerlink" title="keyup 事件"></a>keyup 事件</h2><p>keyup 顧名思義就是鍵盤按下之後放開會觸發的事情，其中傳入 <code>$event</code> 就是傳入 <code>KeyboardEvent</code> 的事件<br><figure class="codeblock codeblock--tabbed"><figcaption><span>keyup template</span><ul class="tabs"><li class="tab active">ts</li></ul></figcaption><div class="tabs-content"><figure class="highlight ts" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span>({  </span><br><span class="line">  template: <span class="string">`</span><br><span class="line">    &lt;input (keyup)="onKey($event)"&gt;    </span><br><span class="line">  `</span></span><br><span class="line">})</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> KeyUpComponent {</span><br><span class="line">  </span><br><span class="line">  onKey(event: KeyboardEvent) {</span><br><span class="line">    <span class="keyword">let</span> value = (&lt;HTMLInputElement&gt;event.target).value;</span><br><span class="line">    ...</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div></figure></p>
<h2 id="使用-template-reference-variable"><a href="#使用-template-reference-variable" class="headerlink" title="使用 template reference variable"></a>使用 template reference variable</h2><p>如果沒有一些特殊邏輯，傳入整個 keyboardEvent 並不是一個很棒的作法，而我們可以用  <a href="https://angular.io/docs/ts/latest/guide/template-syntax.html#ref-vars" title="template reference variable" target="_blank" rel="external">template reference variable</a> 單純傳入 input 物件 或者 input 物件的 value。</p>
<figure class="codeblock codeblock--tabbed"><figcaption><span>template reference variable</span><ul class="tabs"><li class="tab active">ts</li></ul></figcaption><div class="tabs-content"><figure class="highlight ts" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span>({  </span><br><span class="line">  template: <span class="string">`</span><br><span class="line">    &lt;input #box (keyup)="onKey(box.value)"&gt;    </span><br><span class="line">  `</span></span><br><span class="line">})</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> KeyUpComponent_v2 {</span><br><span class="line">  </span><br><span class="line">  onKey(value: <span class="built_in">string</span>) {</span><br><span class="line">    ...</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div></figure>
<h2 id="為了-enter-而生-gt-keyup-enter"><a href="#為了-enter-而生-gt-keyup-enter" class="headerlink" title="為了 enter 而生 =&gt; keyup.enter"></a>為了 enter 而生 =&gt; keyup.enter</h2><p>當使用者點擊 enter 的時候，才觸發事件</p>
<figure class="codeblock codeblock--tabbed"><figcaption><span>keyup.enter</span><ul class="tabs"><li class="tab active">ts</li></ul></figcaption><div class="tabs-content"><figure class="highlight ts" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span>({  </span><br><span class="line">  template: <span class="string">`</span><br><span class="line">    &lt;input #box (keyup.enter)="onEnter(box.value)"&gt;    </span><br><span class="line">  `</span></span><br><span class="line">})</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> KeyUpComponent {  </span><br><span class="line">  onEnter(value: <span class="built_in">string</span>) { ...; }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div></figure>
<h2 id="順便的-blur-事件"><a href="#順便的-blur-事件" class="headerlink" title="順便的 blur 事件"></a>順便的 blur 事件</h2><p>當滑鼠點擊到其他地方的時候，或者是游標離開當下物件的時候才會觸發</p>
<figure class="codeblock codeblock--tabbed"><figcaption><span>keyup.enter</span><ul class="tabs"><li class="tab active">ts</li></ul></figcaption><div class="tabs-content"><figure class="highlight ts" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span>({  </span><br><span class="line">  template: <span class="string">`</span><br><span class="line">    &lt;input #box (blur)="update(box.value)"&gt;    </span><br><span class="line">  `</span></span><br><span class="line">})</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> KeyUpComponent {  </span><br><span class="line">  update(value: <span class="built_in">string</span>) { ... }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div></figure>
<h3 id="參考"><a href="#參考" class="headerlink" title="參考"></a>參考</h3><a href="https://angular.io/docs/ts/latest/guide/user-input.html" title="User Input" target="_blank" rel="external">User Input</a>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;使用者輸入資料的時候，通常會綁定一些事情，做一些邏輯之類的，例如:使用者點選 Enter 則執行搜尋功能等等….&lt;/p&gt;
    
    </summary>
    
      <category term="Angular" scheme="https://mileslin.github.io/categories/Angular/"/>
    
    
      <category term="Angular" scheme="https://mileslin.github.io/tags/Angular/"/>
    
      <category term="input" scheme="https://mileslin.github.io/tags/input/"/>
    
  </entry>
  
  <entry>
    <title>使用 Angular CLI 建立 Angular 專案架構說明</title>
    <link href="https://mileslin.github.io/2017/04/%E4%BD%BF%E7%94%A8-Angular-CLI-%E5%BB%BA%E7%AB%8B-Angular-%E5%B0%88%E6%A1%88%E6%9E%B6%E6%A7%8B%E8%AA%AA%E6%98%8E/"/>
    <id>https://mileslin.github.io/2017/04/使用-Angular-CLI-建立-Angular-專案架構說明/</id>
    <published>2017-04-30T09:46:33.000Z</published>
    <updated>2017-05-21T15:19:04.158Z</updated>
    
    <content type="html"><![CDATA[<p>從頭建立 Angular 專案是一件很麻煩的事情，所以通常都會用 <a href="https://github.com/angular/angular-cli" title="Angular CLI" target="_blank" rel="external">Angular CLI</a> 建立 Anuglar 專案，而今天則要說明 Angular CLI 建立 Angular 專案的檔案內容。</p>
<a id="more"></a>
<h2 id="建立專案"><a href="#建立專案" class="headerlink" title="建立專案"></a>建立專案</h2><p>首先我們要執行 cmd 指令 <code>ng new my-app</code> 建立 Angular 專案，Angular CLI 會幫我們建立這樣專案架構的專案<br><div class="figure " style="width:;"><a class="fancybox" href="Structure.jpg" title="Structure" data-fancybox-group=""><img class="fig-img" src="Structure.jpg" alt="Structure"></a><span class="caption">Structure</span></div></p>
<h2 id="The-root-folder"><a href="#The-root-folder" class="headerlink" title="The root folder"></a>The root folder</h2><p>負責放支援建置 app 的設定檔</p>
<table>
<thead>
<tr>
<th>檔案</th>
<th>說明</th>
</tr>
</thead>
<tbody>
<tr>
<td>e2e/</td>
<td>負責放 End-to-End 測試程式碼的資料夾</td>
</tr>
<tr>
<td>node_modules/</td>
<td><code>Node.js</code> 建立的資料夾，負責放 third party modules 的資料夾，其 thrid party modules 清單則放在 <code>package.json</code>裡面</td>
</tr>
<tr>
<td>.angular-cli.json</td>
<td>放 Angular CLI 的設定檔 <a href="https://github.com/angular/angular-cli/wiki/angular-cli" title="Angular CLI Config Schema" target="_blank" rel="external">Angular CLI Config Schema</a></td>
</tr>
<tr>
<td>.editorconfig</td>
<td>幫助開發者使用不同的 IDEs 保持檔案格式一致性的設定檔 <a href="http://editorconfig.org" title="http://editorconfig.org editorconfig" target="_blank" rel="external"></a></td>
</tr>
<tr>
<td>.gitignore</td>
<td>Git 的設定檔，讓指定檔案不會 commit 到 Source control</td>
</tr>
<tr>
<td>karma.conf.js</td>
<td>Karma test 的 unit tests 設定 <a href="https://karma-runner.github.io/1.0/index.html" title="Karma" target="_blank" rel="external">Karma</a></td>
</tr>
<tr>
<td>package.json</td>
<td>npm 設定檔， third party 清單與版本資訊</td>
</tr>
<tr>
<td>protractor.conf.js</td>
<td>Angular end-to-end test framework <a href="http://www.protractortest.org/#/" title="Protractor" target="_blank" rel="external">Protractor</a> 設定檔</td>
</tr>
<tr>
<td>README.md</td>
<td>Angular CLI 基本指令文件</td>
</tr>
<tr>
<td>tsconfig.json</td>
<td>TypeScript 編譯器設定檔案</td>
</tr>
<tr>
<td>tslint.json</td>
<td>保持 code style 一致性的 <a href="https://palantir.github.io/tslint/" title="TSLint" target="_blank" rel="external">TSLint</a> 設定檔</td>
</tr>
</tbody>
</table>
<h2 id="The-src-folder"><a href="#The-src-folder" class="headerlink" title="The src folder"></a>The src folder</h2><p>寫程式碼的地方。  所有的 Angular components, templates, styles, images 等等…都放這邊。</p>
<div class="figure " style="width:;"><a class="fancybox" href="Src.jpg" title="Src" data-fancybox-group=""><img class="fig-img" src="Src.jpg" alt="Src"></a><span class="caption">Src</span></div>
<table>
<thead>
<tr>
<th>檔案</th>
<th>說明</th>
</tr>
</thead>
<tbody>
<tr>
<td>app/app.component.{ts,html,css,spec.ts}</td>
<td>所有的 Componet、Service、Pipe、Unit test 等等..程式碼都是放在這個資料夾，而 <code>app.component</code> 則是 Angular CLI 預設建立的 root component</td>
</tr>
<tr>
<td>app/app.module.ts</td>
<td>預設的 <a href="https://angular.io/docs/ts/latest/guide/appmodule.html" title="root module" target="_blank" rel="external">root module</a> ， 告訴 Angular 有哪些 Components 、Modules、 Services，讓 Angular 知道如何 assemble the application</td>
</tr>
<tr>
<td>assets/*</td>
<td>放圖片或者是建立 application 需要用的到材料</td>
</tr>
<tr>
<td>environments/*</td>
<td>設定 Angular 程式碼會用到的參數，很像 Web.config 的東西。  預設為 environment.ts ， 要產生不同的 environment 的話，參考命名規則為 environment.xxx.ts，在執行或者 build Angular application 的時候加入 xxx 的參數，則可以指定到該 environmnet ，例如 : <code>ng build -xxx</code>、 <code>ng serve -xxx</code></td>
</tr>
<tr>
<td>favicon.ico</td>
<td>網頁頁籤的 icon <div class="figure " style="width:;"><a class="fancybox" href="icon.jpg" title="" data-fancybox-group=""><img class="fig-img" src="icon.jpg" alt=""></a></div><div style="clear:both;"></div></td>
</tr>
<tr>
<td>index.html</td>
<td>網頁進入點，當使用者拜訪網站的時候，是執行到這個頁面。  在大部分的情況，是不需用編輯的， Angular CLI 在 build application 的時候會自動加入 js 和 css</td>
</tr>
<tr>
<td>main.ts</td>
<td>啟動 application root module(<span class="highlight-text primary">AppModule</span>) 的編譯起始點</td>
</tr>
<tr>
<td>polyfills.ts</td>
<td>因為不同的瀏覽器會支援不同的 web standards， polyfills 就像補丁的概念，補足些沒有支援的部分。 <a href="https://angular.io/docs/ts/latest/guide/browser-support.html" title="Browser Support" target="_blank" rel="external">Browser Support</a></td>
</tr>
<tr>
<td>styles.css</td>
<td>放置 global styles 的 CSS</td>
</tr>
<tr>
<td>test.ts</td>
<td>unit tests 的進入點，有些 unit tests 的設定也寫在這邊</td>
</tr>
<tr>
<td>tsconfig.{app,spec}.json</td>
<td>TypeScript 編譯設定檔 ，<code>tsconfig.app.json</code> for Angular app、 <code>tsconfig.spec.json</code> for unit tests</td>
</tr>
</tbody>
</table>
<h3 id="參考"><a href="#參考" class="headerlink" title="參考"></a>參考</h3><a href="https://angular.io/docs/ts/latest/cli-quickstart.html" title="cli-quickstart" target="_blank" rel="external">CLI QUICKSTART</a>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;從頭建立 Angular 專案是一件很麻煩的事情，所以通常都會用 &lt;a href=&quot;https://github.com/angular/angular-cli&quot; title=&quot;Angular CLI&quot;&gt;Angular CLI&lt;/a&gt; 建立 Anuglar 專案，而今天則要說明 Angular CLI 建立 Angular 專案的檔案內容。&lt;/p&gt;
    
    </summary>
    
      <category term="Angular" scheme="https://mileslin.github.io/categories/Angular/"/>
    
    
      <category term="Angular CLI" scheme="https://mileslin.github.io/tags/Angular-CLI/"/>
    
      <category term="Angular" scheme="https://mileslin.github.io/tags/Angular/"/>
    
  </entry>
  
  <entry>
    <title>Autofac 設定 Web API Register Controller 筆記</title>
    <link href="https://mileslin.github.io/2017/04/Autofac-%E8%A8%AD%E5%AE%9A-Web-API-Register-Controller-%E7%AD%86%E8%A8%98/"/>
    <id>https://mileslin.github.io/2017/04/Autofac-設定-Web-API-Register-Controller-筆記/</id>
    <published>2017-04-28T12:52:13.000Z</published>
    <updated>2017-07-05T03:09:49.187Z</updated>
    
    <content type="html"><![CDATA[<p>Autofac 是一種幫忙管理物件注入的容器，能夠幫助我們在 Controller 建構式注入物件，這樣才有辦法與實體隔離，幫助我們寫單元測試。  今天就來說明怎麼設定 Autofac 使 Controller 建構式注入物件。  今天會以 Web API 為例子。(要注意:MVC的註冊方式有點不同)</p>
<a id="more"></a>
<h2 id="使用容器註冊物件"><a href="#使用容器註冊物件" class="headerlink" title="使用容器註冊物件"></a>使用容器註冊物件</h2><p>為了方便整理，我會先新增 <code>AutofacConfig.cs</code> 放在 App_Start 資料夾裡面， <code>AutofacConfig.cs</code> 則負責註冊。</p>
<ul>
<li>安裝 <a href="https://www.nuget.org/packages/Autofac.WebApi2/" title="Autofac.WebAPi2" target="_blank" rel="external">Autofac.WebAPi2</a></li>
<li>先註冊所有 Web API Controller 到 ContainerBuilder</li>
<li>註冊所有 Controller 要相依的物件，這邊以 IConfiguration 為例子，表示 Controller 建構式注入 IConfiguration 時會取得 Configuration 物件</li>
<li>開啟 <code>Global.asax.cs</code> 加入 <code>AutofacConfig.Bootstrapper()</code><figure class="codeblock codeblock--tabbed"><figcaption><span>AutofacConfig</span><ul class="tabs"><li class="tab active">cs</li></ul></figcaption><div class="tabs-content"><figure class="highlight cs" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">AutofacConfig</span></span><br><span class="line">{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Bootstrapper</span>(<span class="params"></span>)</span><br><span class="line">    </span>{</span><br><span class="line">        <span class="keyword">var</span> builder = <span class="keyword">new</span> ContainerBuilder();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Get your HttpConfiguration.</span></span><br><span class="line">        <span class="keyword">var</span> config = GlobalConfiguration.Configuration;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Register your Web API controllers.</span></span><br><span class="line">        builder.RegisterApiControllers(Assembly.GetExecutingAssembly());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// OPTIONAL: Register the Autofac filter provider.</span></span><br><span class="line">        builder.RegisterWebApiFilterProvider(config);</span><br><span class="line"></span><br><span class="line">        builder.RegisterType&lt;Configuration&gt;()</span><br><span class="line">           .As&lt;IConfiguration&gt;()</span><br><span class="line">           .InstancePerLifetimeScope();</span><br><span class="line"></span><br><span class="line">        builder.RegisterType&lt;Configuration&gt;()</span><br><span class="line">           .As&lt;IConfiguration&gt;()</span><br><span class="line">           .InstancePerLifetimeScope();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> container = builder.Build();</span><br><span class="line"></span><br><span class="line">        config.DependencyResolver = <span class="keyword">new</span> AutofacWebApiDependencyResolver(container);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div></figure>
</li>
</ul>
<p>打開 <code>Global.asax.cs</code> 加入 <code>AutofacConfig.Bootstrapper();</code><br><figure class="codeblock codeblock--tabbed"><figcaption><span>Global.asax.cs</span><ul class="tabs"><li class="tab active">cs</li></ul></figcaption><div class="tabs-content"><figure class="highlight" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">public class WebApiApplication : System.Web.HttpApplication</span><br><span class="line">{</span><br><span class="line">    protected void Application_Start()</span><br><span class="line">    {</span><br><span class="line">        AreaRegistration.RegisterAllAreas();</span><br><span class="line">        GlobalConfiguration.Configure(WebApiConfig.Register);</span><br><span class="line">        FilterConfig.RegisterGlobalFilters(GlobalFilters.Filters);</span><br><span class="line">        RouteConfig.RegisterRoutes(RouteTable.Routes);</span><br><span class="line">        BundleConfig.RegisterBundles(BundleTable.Bundles);</span><br><span class="line">        </span><br><span class="line">        // 加入這行</span><br><span class="line">        AutofacConfig.Bootstrapper();</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div></figure></p>
<p>接下來 Controller 就可以建構式注入 IConfiguration 取得 Configuration 物件<br><figure class="codeblock codeblock--tabbed"><figcaption><span>Controller</span><ul class="tabs"><li class="tab active">cs</li></ul></figcaption><div class="tabs-content"><figure class="highlight cs" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ValuesController</span> : <span class="title">ApiController</span></span><br><span class="line">{</span><br><span class="line">    IConfiguration _configuration;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ValuesController</span>(<span class="params">IConfiguration configuration</span>)</span><br><span class="line">    </span>{</span><br><span class="line">        _configuration = configuration;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div></figure></p>
<h2 id="建立-Autofac-Module"><a href="#建立-Autofac-Module" class="headerlink" title="建立 Autofac.Module"></a>建立 Autofac.Module</h2><p>當註冊物件一多的時候，我們可以建立 <code>Aufofac.Module</code> 把註冊這件事情分散在各個 Module 處理。</p>
<p>例如我建立一個 EFModule ，註冊 Entities。<br><figure class="codeblock codeblock--tabbed"><figcaption><span>EFModule</span><ul class="tabs"><li class="tab active">cs</li></ul></figcaption><div class="tabs-content"><figure class="highlight" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public class EFModule : Autofac.Module</span><br><span class="line">{</span><br><span class="line">    protected override void Load(ContainerBuilder builder)</span><br><span class="line">    {</span><br><span class="line">        builder.RegisterType&lt;WebPaymentEntities&gt;()</span><br><span class="line">           .As&lt;WebPaymentEntities&gt;()</span><br><span class="line">           .InstancePerLifetimeScope();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div></figure></p>
<p>我的 ContainerBuilder 只要註冊 Module 就好<br><figure class="codeblock codeblock--tabbed"><figcaption><span>Register Module</span><ul class="tabs"><li class="tab active">cs</li></ul></figcaption><div class="tabs-content"><figure class="highlight cs" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Bootstrapper</span>(<span class="params"></span>)</span><br><span class="line">    </span>{</span><br><span class="line">        <span class="keyword">var</span> builder = <span class="keyword">new</span> ContainerBuilder();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Get your HttpConfiguration.</span></span><br><span class="line">        <span class="keyword">var</span> config = GlobalConfiguration.Configuration;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Register your Web API controllers.</span></span><br><span class="line">        builder.RegisterApiControllers(Assembly.GetExecutingAssembly());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// OPTIONAL: Register the Autofac filter provider.</span></span><br><span class="line">        builder.RegisterWebApiFilterProvider(config);</span><br><span class="line"></span><br><span class="line">        builder.RegisterType&lt;Configuration&gt;()</span><br><span class="line">           .As&lt;IConfiguration&gt;()</span><br><span class="line">           .InstancePerLifetimeScope();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 註冊 Module</span></span><br><span class="line">        builder.RegisterModule(<span class="keyword">new</span> EFModule());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> container = builder.Build();</span><br><span class="line"></span><br><span class="line">        config.DependencyResolver = <span class="keyword">new</span> AutofacWebApiDependencyResolver(container);</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure></div></figure></p>
<h2 id="一次註冊多個物件"><a href="#一次註冊多個物件" class="headerlink" title="一次註冊多個物件"></a>一次註冊多個物件</h2><p>在寫 MVC 或 Web API 的時候可以常見到 <a href="https://msdn.microsoft.com/en-us/library/ff649690.aspx" title="Repository Pattern" target="_blank" rel="external">Repository Pattern</a> 而 Repository Pattern 有一定的命名規格，例如: 介面 <code>IxxxRepository</code> 會對應到一個類別 <code>xxxRepository</code>。<br><figure class="codeblock codeblock--tabbed"><figcaption><span>Repository</span><ul class="tabs"><li class="tab active">cs</li></ul></figcaption><div class="tabs-content"><figure class="highlight cs" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ProductRepository</span> : <span class="title">IProductRepository</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">private</span> WebPaymentEntities context;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ImportContainerRepository</span>(<span class="params">WebPaymentEntities context</span>)</span><br><span class="line">    </span>{</span><br><span class="line">        <span class="keyword">this</span>.context = context;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div></figure></p>
<p>我們就可以用這命名的 Pattern 建立一個 Autofac Module 註冊所有的 Repository</p>
<figure class="codeblock codeblock--tabbed"><figcaption><span>Respository Module</span><ul class="tabs"><li class="tab active">cs</li></ul></figcaption><div class="tabs-content"><figure class="highlight" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">public class RepositoryModule : Autofac.Module</span><br><span class="line">{</span><br><span class="line">    protected override void Load(ContainerBuilder builder)</span><br><span class="line">    {</span><br><span class="line">        builder.RegisterAssemblyTypes(typeof(WebApiApplication).Assembly)</span><br><span class="line">               .Where(t =&gt; t.Name.EndsWith("Repository"))</span><br><span class="line">               .AsImplementedInterfaces()</span><br><span class="line">              .InstancePerLifetimeScope();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div></figure>
<h2 id="小結"><a href="#小結" class="headerlink" title="小結"></a>小結</h2><p>通常 Autofac 設定一次就很少再設定了，所以沒有研究很深，就先筆記到這邊，等之後需要其他應用的時候，再來詳細閱讀官方文件。</p>
<h3 id="參考"><a href="#參考" class="headerlink" title="參考"></a>參考</h3><a href="http://autofac.readthedocs.io/en/latest/integration/webapi.html#register-controllers" title="Autofac官方文件" target="_blank" rel="external">Autofac 官方文件</a>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Autofac 是一種幫忙管理物件注入的容器，能夠幫助我們在 Controller 建構式注入物件，這樣才有辦法與實體隔離，幫助我們寫單元測試。  今天就來說明怎麼設定 Autofac 使 Controller 建構式注入物件。  今天會以 Web API 為例子。(要注意:MVC的註冊方式有點不同)&lt;/p&gt;
    
    </summary>
    
      <category term="Autofac" scheme="https://mileslin.github.io/categories/Autofac/"/>
    
    
      <category term=".NET" scheme="https://mileslin.github.io/tags/NET/"/>
    
      <category term="C#" scheme="https://mileslin.github.io/tags/C/"/>
    
      <category term="Autofac" scheme="https://mileslin.github.io/tags/Autofac/"/>
    
  </entry>
  
</feed>
